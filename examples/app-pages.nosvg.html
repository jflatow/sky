<!doctype html>
<html>
  <head>
    <title>Pages (No SVG)</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
    <style>
      * {
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: Helvetica Neue;
        font-weight: 300;
      }

      main {
        height: 100%;
        width: 100%;
        text-align: center;
      }

      .circle, .ellipse {
        background-color: #000000;
      }

      .rect {
        background-color: #f8f8f8;
      }

      .icon {
        fill: red;
      }

      .trigger {
        cursor: pointer;
        color: blue;
        fill: blue;
      }

      .navbar {
        font-size: 1em;
      }

      .navbar > .rect {
        box-shadow: 0px 0px 1px #aaa;
      }

      .navbar .title {
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <main></main>
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none">
      <defs>
        <symbol id="coffee" viewBox="0 -3000 2390 3500">
          <g transform="scale(1, -1)">
            <path d="M852 2488 c-19 -19 -14 -37 17 -77 78 -99 77 -143 -5 -246 -77 -97 -93 -126 -100 -176 -8 -57 8 -113 47 -172 34 -52 59 -70 83 -61 31 12 28 42 -9 95 -66 96 -61 134 34 255 115 144 118 223 14 352 -35 43 -59 52 -81 30z"/>
            <path d="M1192 2488 c-19 -19 -14 -36 28 -89 41 -52 57 -101 46 -143 -3 -14 -32 -58 -65 -98 -92 -115 -112 -169 -91 -249 12 -48 73 -144 96 -153 21 -8 54 11 54 32 0 9 -16 39 -35 66 -41 58 -52 105 -34 147 7 18 41 67 75 110 34 43 68 95 74 115 25 75 -4 167 -78 247 -28 29 -51 34 -70 15z"/>
            <path d="M1530 2479 c-9 -16 -8 -25 5 -42 102 -139 101 -166 -10 -302 -63 -78 -78 -111 -78 -176 0 -41 6 -68 27 -105 31 -58 71 -104 89 -104 37 0 49 56 18 84 -11 10 -29 40 -41 69 -29 66 -19 98 56 192 74 92 94 134 94 192 0 59 -26 118 -75 172 -41 45 -69 52 -85 20z"/>
            <path d="M405 1543 c48 -585 142 -1002 262 -1160 l24 -33 504 0 505 0 36 55 c20 30 51 94 70 142 l33 88 83 7 c274 23 468 225 468 488 0 214 -132 395 -339 465 l-73 25 -790 0 -790 0 7 -77z m1620 -154 c92 -44 165 -157 165 -259 0 -141 -110 -262 -259 -284 -42 -6 -43 -6 -37 17 12 49 55 327 66 435 7 61 14 112 16 112 3 0 24 -10 49 -21z"/>
            <path d="M14 241 c21 -39 114 -122 180 -160 31 -17 89 -42 130 -56 l75 -25 793 0 c887 0 834 -4 981 73 84 43 170 115 200 166 l18 31 -1196 0 -1196 0 15 -29z"/>
          </g>
        </symbol>
        <symbol id="drink" viewBox="-200 -1050 1200 1200">
          <g transform="scale(1,-1)">
            <path d="M193 857 c-70 -80 -130 -255 -120 -353 13 -124 89 -199 231 -225 l66 -12 0 -46 0 -46 -85 -29 c-106 -36 -124 -48 -106 -69 19 -24 108 -38 223 -38 133 1 212 18 216 47 3 19 -10 26 -95 55 l-98 34 -3 46 -3 47 48 6 c127 18 215 77 241 162 34 116 -12 310 -101 417 l-24 28 -179 6 -180 5 -31 -35z m397 -64 c65 -102 97 -231 78 -317 -23 -111 -121 -161 -297 -154 -118 5 -179 30 -219 91 -24 37 -27 49 -26 126 1 95 19 153 76 247 l32 54 163 0 163 0 30 -47z m-126 -688 c29 -12 25 -13 -64 -13 l-95 -1 40 19 c41 20 66 19 119 -5z"/>
            <path d="M166 614 c-3 -9 -6 -45 -6 -81 0 -110 42 -153 172 -174 34 -6 87 -7 117 -3 149 18 204 82 186 219 l-6 55 -229 0 c-199 0 -229 -2 -234 -16z m75 -89 c3 -29 12 -53 23 -61 12 -8 16 -19 12 -30 -6 -15 -9 -15 -29 -2 -28 19 -52 86 -43 122 10 41 30 26 37 -29z"/>
          </g>
        </symbol>

        <symbol id="lunch" viewBox="0 -1000 1200 900">
          <g transform="scale(1,-1)">
            <path d="M540 785 c-7 -8 -28 -15 -46 -15 -24 0 -34 -5 -34 -15 0 -10 10 -15 29 -15 17 0 33 -4 36 -10 4 -6 -7 -10 -24 -10 -47 0 -41 -28 7 -32 l37 -3 3 -62 3 -62 -139 -3 -139 -3 84 -133 c46 -74 81 -138 77 -143 -3 -6 -47 56 -97 136 -76 120 -95 145 -115 145 l-24 0 21 -32 c12 -18 56 -88 98 -155 l78 -123 191 0 190 0 87 153 87 152 -135 3 -135 3 0 61 0 61 250 -8 250 -7 0 26 0 26 -246 0 c-161 0 -243 3 -239 10 4 6 95 10 241 10 l234 0 0 26 0 27 -137 -7 c-235 -10 -347 -10 -351 3 -5 16 -32 14 -38 -4 -6 -14 -8 -13 -19 2 -11 15 -15 15 -29 4 -12 -10 -19 -11 -30 -2 -10 9 -16 8 -26 -4z m60 -166 c0 -33 -4 -59 -10 -59 -6 0 -10 29 -10 66 0 41 4 63 10 59 6 -3 10 -33 10 -66z m50 1 c0 -47 -3 -60 -15 -60 -12 0 -15 13 -15 60 0 47 3 60 15 60 12 0 15 -13 15 -60z"/>
          </g>
        </symbol>
        <symbol id="dinner" viewBox="0 -20 300 350">
          <g>
            <path d="M77.53 32.06 C 77.33 29.61 78.35 26.65 81.05 26.13 C 84.09 25.26 86.97 28.09 86.73 31.10 C 86.86 49.21 86.74 67.32 86.79 85.43 C 92.11 85.43 97.43 85.45 102.76 85.42 C 102.76 67.26 102.70 49.10 102.78 30.95 C 102.50 28.15 105.02 25.48 107.88 26.08 C 110.59 26.56 111.59 29.52 111.41 31.96 C 111.39 49.78 111.45 67.60 111.38 85.41 C 116.91 85.46 122.44 85.43 127.97 85.44 C 128.00 67.25 127.91 49.06 128.01 30.88 C 127.75 28.14 130.25 25.69 132.98 26.12 C 135.87 26.34 137.24 29.34 136.97 31.93 C 136.96 56.31 137.00 80.70 136.95 105.08 C 137.06 113.90 129.25 121.80 120.45 121.93 C 120.43 165.96 120.44 209.99 120.44 254.01 C 120.47 257.69 119.97 261.60 117.69 264.63 C 113.26 271.05 102.53 271.34 97.73 265.21 C 95.11 262.13 94.48 257.95 94.53 254.04 C 94.53 210.01 94.53 165.98 94.53 121.95 C 88.56 121.82 82.65 118.63 79.81 113.29 C 77.84 109.87 77.46 105.84 77.52 101.97 C 77.54 78.67 77.52 55.36 77.53 32.06 Z" />
            <path d="M181.13 36.15 C 184.18 30.35 190.45 26.51 196.97 26.19 C 204.22 25.66 211.66 29.54 215.11 35.98 C 217.55 40.20 218.05 45.18 218.03 49.96 C 218.03 117.97 218.03 185.97 218.04 253.98 C 218.09 257.58 217.57 261.40 215.32 264.34 C 211.30 269.83 202.62 270.69 197.34 266.56 C 193.51 264.13 192.08 259.33 192.14 255.01 C 192.10 227.74 192.14 200.46 192.12 173.19 C 187.52 173.18 182.91 173.19 178.31 173.18 C 178.31 132.12 178.31 91.05 178.31 49.98 C 178.30 45.25 178.78 40.35 181.13 36.15 Z" />
          </g>
        </symbol>
      </defs>
    </svg>
    <script src="all"></script>
    <script>
      (function () {
        var Cage = Sun.Cage, up = Sun.up;
        var style = Sky.$(document.head).child('style')
        style.node.sheet.insertRule('.icon { fill: ' + Sky.RGB.random() + '}', 0)

        var em = 16;
        var root = Sky.$('main')
        var opts = {aspectRatio: Math.min(window.innerWidth / window.innerHeight, .8)}
        var dims, frame = iOS.iOS7x.frame(root)
        var size = function () {
          var win = Sky.box(0, 0, window.innerWidth, window.innerHeight)
          if (win.w < win.h)
            dims = Sky.box(0, 0, win.w, win.w / opts.aspectRatio)
          else
            dims = Sky.box(100, 0, win.h * opts.aspectRatio, win.h)
          frame.setOpts(up(opts, {dims: dims.center(win.midX, win.midY)}))
        }
        setTimeout(size)
        window.onresize = size;

        var main = window.main = iOS.iOS7x.nav(function (nav) {
          return {
            settings: {title: 'Settings'},
            skej: {title: 'Skej'},
            queue: {title: 'Queue'},
            who: {title: 'Who'},
            when: {title: 'When'},
            where: {title: 'Where'},
            review: {title: 'Review'}
          }
        }, frame)

        /* drawing */

        main.pages.settings.draw = function (win) {
          var back = win.background()
          var tbar = win.navbar({
            left: {label: 'Feedback', action: main.action('shut', up(win.state, {parent: {tag: 'settings'}}), null)},
            right: {label: 'Skej', action: win.action('step', 'skej', null)}
          })
          var dims = win.dims.trim(tbar.dims.height, 0, 0, 0)
          var elem = win.content;
          back.bgrd.style({backgroundColor: Sky.RGB.random()})
          elem.tap(win.action('reload', null))
          // NB: redraw would bind to same element
          //     pure bind would not trigger segue
        }

        main.pages.skej.draw = function (win) {
          var page = this;
          var data = win.state.data || new Cage({})
          var back = win.background()
          var tbar = win.navbar({right: {label: 'Queue', action: win.action('step', 'queue', data)}})
          var dims = win.dims.trim(tbar.dims.h, 0, 0, 0)
          var elem = win.content;

          var Activity = Orb.type(function (_, root, opts) {
            var opts = this.opts = Sun.up({}, opts)
            var dims = this.dims = opts.dims;
            var elem = this.elem = root.g()

            var bgd = elem.rectX(dims).style({backgroundColor: '#fff'})
            var txt = elem.textX(dims, opts.what)
            var ccl = elem.circleX(Sky.box(0, 0, 20, 20).align(dims, -.9, -.9))
            elem.iconX(Sky.box(0, 0, 50, 50).align(dims, 0, -.9), '#' + opts.what.toLowerCase())

            var self = this;
            var jack = this.jack = elem.guide(elem.wagon(null, {bbox: {y: 0, height: 0}}), {
              kx: 2,
              bbox: dims,
            })

            var toggle;
            ccl.tap(function () {
              Orb.drag(jack, 'goto', toggle ? [0, 1] : [1, 0])
              toggle = !toggle;
            }, {stop: true})
          })

          var keys = ['Meet', 'Call', 'Coffee', 'Drink', 'Lunch', 'Dinner']
          dims.grid(function (a, b, i, j, n) {
            var what = keys[n]
            var btn = a.trigger(function () { win.do('open', 'who', data.update({what: what})) })
            Activity(btn, {dims: b, what: what})
            return a;
          }, elem.g(), {rows: 3, cols: 2})
          back.bgrd.style({backgroundColor: Sky.RGB.random()})

          var drag = elem.rect(dims.x, dims.y, .1 * dims.w, dims.h).style({opacity: .4})
          drag.swipe(elem.orb({
            grab: function () {
              this.jack = main.back(win.state, data)
              this.jack.grab()
            }
          }), {prevent: true})
        }

        main.pages.who.draw = function (win) {
          var page = this;
          var data = win.state.data;
          var back = win.background()
          var tbar = win.navbar({right: {label: 'Cancel', action: win.action('shut', null) }})
          var dims = win.dims.trim(tbar.dims.h, 0, 0, 0)
          var elem = win.content;

          data.update({who: 'Just me'})

          elem.textX(dims, data.get('what'))
          elem.trigger(function () {
            win.do('step', 'when', data)
          }).textX(dims, 'Next', 0, .5)

          var b = dims.copy({h: 2 * em})
        }

        main.pages.when.draw = function (win) {
          var page = this;
          var data = win.state.data;
          var back = win.background()
          var tbar = win.navbar({right: {label: 'Cancel', action: win.action('shut', null) }})
          var dims = win.dims.trim(tbar.dims.h, 0, 0, 0)
          var elem = win.content;

          data.update({when: new Date})

          elem.textX(dims, data.get('who'))
          elem.trigger(win.action('step', 'where', data)).textX(dims, 'Next', 0, .5)
        }

        main.pages.where.draw = function (win) {
          var page = this;
          var data = win.state.data;
          var back = win.background()
          var tbar = win.navbar({right: {label: 'Cancel', action: win.action('shut', null) }})
          var dims = win.dims.trim(tbar.dims.h, 0, 0, 0)
          var elem = win.content;

          data.update({where: 'Palo Alto'})

          elem.textX(dims, data.get('when'))
          elem.trigger(win.action('step', 'review', data)).textX(dims, 'Next', 0, .5)
        }

        main.pages.review.draw = function (win) {
          var page = this;
          var data = win.state.data;
          var back = win.background()
          var tbar = win.navbar({right: {label: 'Cancel', action: win.action('shut', null) }})
          var dims = win.dims.trim(tbar.dims.h, 0, 0, 0)
          var elem = win.content;

          elem.textX(dims, data.get('where'))
          elem.trigger(function () {
            win.do('shut', data)
          }).textX(dims, 'Skej', 0, .5)
        }

        main.pages.queue.draw = function (win) {
          var back = win.background()
          var tbar = win.navbar()
          var dims = win.dims.trim(tbar.dims.height, 0, 0, 0)
          var elem = win.content;
          elem.tap(win.action('reload', win.state.data))
        }

        main.launch({tag: 'skej', prev: {tag: 'settings'}})
      })();
    </script>
  </body>
</html>
