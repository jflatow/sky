{"version":3,"sources":["../../spackle/node_modules/browser-pack/_prelude.js","all.js","../sky.js","../sun.js","../ext/geo.js","../ext/orb.js","../nav/ufo.js","../nav/ios.js"],"names":["Sky","require","Sun","Geo","Orb","UFO","iOS","Box","d","e","this","x","def","left","Inf","y","top","w","width","h","height","RGB","up","elem","a","p","Elem","attrs","props","doc","node","nodeType","document","createElementNS","xmlns","svg","SVGElem","apply","arguments","env","abs","Math","min","max","Rt2","sqrt","Infinity","add","isFinite","isNaN","dfn","undefined","fnt","get","k","v","pop","pre","b","ext","Object","create","map","f","wrap","namespaceURI","prototype","util","update","extend","copy","clip","m","M","randInt","round","random","trig","rad","PI","sin","cos","cut","path","cmd","slice","call","P","xy","L","join","reduce","line","x1","y1","x2","y2","open","rect","border","box","t","r","l","ix","iy","iw","ih","corner","rx","ry","vh","iv","sx","sy","dx","dy","sd","cx","cy","chevron","g","o","z","atan2","triangle","arc","len","off","fx","fy","oval","arch","ring","wedge","snake","my","mx","units","u","Q","unify","defaults","right","bottom","translate","rotate","skewX","skewY","borderRadius","strip","n","length","substr","parseFloat","each","ks","calc","concat","url","constructor","midX","midY","grid","fun","acc","opts","rows","cols","c","i","j","shift","boxs","bnds","tile","count","unit","stack","times","shape","s","over","split","push","align","ax","ay","nx","ny","ox","oy","center","scale","square","big","ps","hzn","part","pct","ko","kd","pad","trim","ow","oh","equals","toString","solve","bbox","mix","lo","hi","obj","alpha","xml","addTo","parent","appendChild","append","child","clear","firstChild","removeChild","order","parentNode","C","childNodes","insertBefore","remove","$","q","querySelector","ownerDocument","sel","querySelectorAll","root","attached","detached","unique","hide","hidden","show","attr","name","ns","getAttributeNS","removeAttributeNS","setAttributeNS","style","space","txt","text","createTextNode","textContent","uid","id","Date","addClass","cls","classList","hasClass","contains","removeClass","removeAttribute","css","getComputedStyle","addRules","rules","sheet","selector","rule","str","property","insertRule","animate","self","anim","window","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","callee","bind","on","types","capture","type","addEventListener","removeEventListener","trigger","data","dispatchEvent","CustomEvent","detail","upon","once","til","dead","class","link","href","para","div","span","form","input","image","src","xywh","circle","ellipse","icon","svgX","viewBox","resize","iconX","imageX","circleX","ellipseX","px","py","rectX","textX","anchor","transform","getBoundingClientRect","pageXOffset","pageYOffset","polar","place","screen","transformation","desc","xform","-moz-transform","-ms-transform","-o-transform","-webkit-transform","val","tx","exec","xlink","polyline","points","polygon","tspan","use","mask","clipPath","text-anchor","dominant-baseline","getBBox","enc","tagName","ownerSVGElement","fit","point","createSVGPoint","matrixTransform","getScreenCTM","list","baseVal","numberOfItems","getItem","matrix","SVGTransform","SVG_TRANSFORM_MATRIX","SVG_TRANSFORM_TRANSLATE","SVG_TRANSFORM_SCALE","SVG_TRANSFORM_ROTATE","angle","SVG_TRANSFORM_SKEWX","SVG_TRANSFORM_SKEWY","module","exports","rgb","cons","base","int","parseInt","sgn","pow","mod","opt","item","Array","nchoosek","bezier","clockdist","ellipsis","start","step","stop","range","fold","format","fmt","arg","replace","keyfun","key","Function","lookup","modify","pen","last","object","iter","select","repeat","every","setTimeout","throttle","T","clearTimeout","Cage","__opt__","sep","__obj__","__fns__","change","keys","fns","indexOf","old","URL","scheme","authority","query","fragment","encode","encodeURIComponent","decode","kv","decodeURIComponent","H","http","method","hdrs","req","XMLHttpRequest","onreadystatechange","readyState","DONE","_","setRequestHeader","send","put","post","drop","splice","groupby","k_","insert","lte","keyindex","eq","keydrop","keymodify","umerge","lt","values","vals","Sec","Min","Hour","Day","Week","DoW","MoY","time","set","rel","getFullYear","getMonth","getDate","getHours","mi","getMinutes","getSeconds","ms","getMilliseconds","pass","dif","setFullYear","setMonth","setDate","setHours","setMinutes","setSeconds","setMilliseconds","jump","parse","stamp","dsep","utc","tsep","dtp","datep","timep","substring","UTC","datestamp","timestamp","fromGregorian","toGregorian","daysInMonth","isLeapYear","weekday","getDay","month","MTS","spec","log","asin","haversin","sqr","deg","tan","project","mercator","lat","lng","haversine","lat_","lng_","mts","jack","zoom","size","dims","loops","overlay","markers","tiles","ceil","R","draw","img","loop","wx","wy","wagon","move","dz","dk","U","rnd","E","cat","noop","touch","pointerdown","pointermove","pointerup","grip","prop","grab","free","sync","drag","walk","thru","do","proto","defineProperty","tap","Dx","Dy","gap","swipe","orb","stopImmediatePropagation","dbltap","taps","prevent","preventDefault","press","gain","setInterval","clearInterval","lx","ly","glob","that","touches","pageX","pageY","scroll","wheelDeltaX","wheelDeltaY","amp","kx","ky","setOpts","spring","lock","ty","restore","stretch","balance","perturb","more","guide","settle","truncate","dist","slot","far","hook","tether","xmin","xmax","ymin","ymax","plug","coil","ux","uy","crank","wide","high","cur","belt","wbox","orbs","mapk","treadmill","init","soln","wheel","gunit","active","offset","zero","tmill","getActive","setActive","dolly","vbox","dim","Nav","frame","pages","manageHistory","onpopstate","state","go","fromHistory","tag","prev","toHash","keep","prior","location","hash","page","btoa","JSON","stringify","fromHash","atob","toHistory","changeHistory","history","title","launch","kept","action","load","segue","fn","win","redraw","reset","nav","reload","transition","back","shut","Frame","pkg","windows","didBecomeInactive","didBecomeActive","addWindow","removeWindow","Window","percent","xfer","plugs","doBecomeActive","didNotBecomeActive","what","Basic","button","iOS7x","content","chrome","opacity","background","bgrd","navbar","lbtn","label","rbtn","tbar"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","Sky = require('../sky')\nSun = require('../sun')\nGeo = require('../ext/geo')\nOrb = require('../ext/orb')\nUFO = require('../nav/ufo')\niOS = require('../nav/ios')\n","var env = require('./env') // NB: imports globals for node, not used directly\nvar abs = Math.abs, min = Math.min, max = Math.max, Rt2 = Math.sqrt(2), Inf = Infinity;\nvar add = function (p, d) { return isFinite(d) ? p + d : d }\nvar def = function (x, d) { return isNaN(x) ? d : x }\nvar dfn = function (x, d) { return x == undefined ? d : x }\nvar fnt = function (x, d) { return isFinite(x) ? x : d }\nvar get = function (a, k, d) { var v = a[k]; return dfn(v, d) }\nvar pop = function (a, k, d) { var v = get(a, k, d); delete a[k]; return v }\nvar pre = function (a, k, d) { return a[k] = get(a, k, d) }\nvar up = function (a, b) {\n  for (var k in b)\n    a[k] = b[k]\n  return a;\n}\nvar ext = function (a, b) { return up(Object.create(a), b) }\nvar map = function (a, f) { return a && a.map ? a.map(f) : f(a) }\nvar wrap = function (node) {\n  if (node)\n    switch (node.namespaceURI) {\n    case SVGElem.prototype.xmlns: return new SVGElem(node)\n    case Elem.prototype.xmlns:\n    default: return new Elem(node)\n    }\n}\nvar util = {\n  add: add,\n  def: def,\n  dfn: dfn,\n  fnt: fnt,\n  get: get,\n  pop: pop,\n  pre: pre,\n  update: up,\n  extend: ext,\n  map: map,\n  wrap: wrap,\n  copy: function (b) { return up({}, b) },\n  clip: function (x, m, M) { return min(max(x, m), M) },\n  randInt: function (m, M) { return Math.round((M - m) * Math.random()) + m }\n}\n\nvar trig = util.trig = {\n  rad: function (a) { return Math.PI / 180 * a },\n  sin: function (a) { return Math.sin(trig.rad(a)) },\n  cos: function (a) { return Math.cos(trig.rad(a)) },\n  cut: function (x) { return util.clip(x, -359.999, 359.999) }\n}\n\nvar path = function (cmd) { return cmd + [].slice.call(arguments, 1) }\nvar P = up(path, {\n  M: function (xy) { return P('M', xy) },\n  L: function (xy) { return P('L', xy) },\n  join: function () {\n    return [].reduce.call(arguments, function (d, a) { return d + P.apply(null, a) }, '')\n  },\n  line: function (x1, y1, x2, y2, open) {\n    var open = open || P.M;\n    return open([x1, y1]) + P.L([x2, y2])\n  },\n  rect: function (x, y, w, h, open) {\n    var open = open || P.M;\n    var h = def(h, w)\n    return open([x, y]) + P('H', x + w) + P('V', y + h) + P('H', x) + 'Z';\n  },\n  border: function (box, t, r, b, l, open) {\n    var t = def(t, 0), r = def(r, t), b = def(b, t), l = def(l, r)\n    with (box) {\n      var ix = x + l, iy = y + t, iw = w - l - r, ih = h - t - b;\n      return (P.line(x, y, x + w, y, open) + P('v', h) + P('h', -w) + P('v', -h) +\n              P.line(ix, iy, ix, iy + ih) + P('h', iw) + P('v', -ih) + P('h', -iw))\n    }\n  },\n  corner: function (x1, y1, x2, y2, rx, ry, vh, iv, open) {\n    var open = open || P.M;\n    var rx = def(rx, 0), ry = def(ry, rx), iv = def(iv, 0)\n    var sx = x1 < x2 ? 1 : -1, sy = y1 < y2 ? 1 : -1;\n    var dx = sx * rx, dy = sy * ry;\n    var sd = vh ^ iv ? +(sx * sy < 0) : +(sx * sy > 0)\n    if (vh) {\n      var cx = x1 + dx, cy = y2 - dy;\n      return open([x1, y1]) + P('v', cy - y1) + P('a', rx, ry, 0, 0, sd, dx, dy) + P('h', x2 - cx)\n    } else {\n      var cx = x2 - dx, cy = y1 + dy;\n      return open([x1, y1]) + P('h', cx - x1) + P('a', rx, ry, 0, 0, sd, dx, dy) + P('v', y2 - cy)\n    }\n  },\n  chevron: function (cx, cy, w, h, t, open) {\n    var open = open || P.M;\n    var h = def(h, 2 * w), g = h / 2;\n    var t = def(t, w * Rt2 / 5), o = t / Rt2, z = t / abs(Math.sin(Math.atan2(g, w - o)))\n    var x = cx - w / 2, y = cy - g + o;\n    return open([x, y]) + P('l', o, -o) + P('l', w - o, g) + P('l', o - w, g) + P('l', -o, -o) + P('l', w - z, o - g) + 'z'\n  },\n  triangle: function (cx, cy, b, h, open) {\n    var open = open || P.M;\n    var h = def(h, b)\n    var x = cx - b / 2, y = cy - h / 2;\n    return open([x, y]) + P('L', cx, y + h) + P('L', x + b, y) + 'Z';\n  },\n  arc: function (cx, cy, rx, ry, len, off, open) {\n    var open = open || P.M;\n    var len = trig.cut(def(len, 360)), off = off || 0;\n    var ix = cx + rx * trig.cos(off), iy = cy + ry * trig.sin(off)\n    var fx = cx + rx * trig.cos(off + len), fy = cy + ry * trig.sin(off + len)\n    return (open([ix, iy]) +\n            P('A',\n              rx, ry, 0,\n              abs(len) > 180 ? 1 : 0,\n              len > 0 ? 1 : 0,\n              fx, fy))\n  },\n  oval: function (cx, cy, rx, ry, open) {\n    var ry = def(ry, rx)\n    return P.arc(cx, cy, rx, ry, 360, 0, open)\n  },\n  arch: function (cx, cy, rx, ry, t, len, off, open) {\n    var len = trig.cut(def(len, 360)), off = off || 0;\n    var t = def(t, 1)\n    return (P.arc(cx, cy, rx, ry, len, off, open) +\n            P.arc(cx, cy, rx + t, ry + t, -len, off + len, P.L) + 'Z')\n  },\n  ring: function (cx, cy, rx, ry, t, open) {\n    var t = def(t, 1)\n    return (P.arc(cx, cy, rx, ry, 360, 0, open) +\n            P.arc(cx, cy, rx + t, ry + t, -360, 360))\n  },\n  wedge: function (cx, cy, rx, ry, len, off, open) {\n    var open = open || P.M;\n    return open([cx, cy]) + P.arc(cx, cy, rx, ry, len, off, P.L) + 'Z';\n  },\n  snake: function (x1, y1, x2, y2, vh) {\n    if (vh) {\n      var my = (y1 + y2) / 2;\n      return P('C', x1, my, x2, my, x2, y2)\n    } else {\n      var mx = (x1 + x2) / 2;\n      return P('C', mx, y1, mx, y2, x2, y2)\n    }\n  }\n})\n\nvar units = function (o, u) {\n  var t = {}\n  for (var k in o)\n    t[k] = Q.unify(k, o[k], u)\n  return t;\n}\nvar Q = up(units, {\n  defaults: {\n    top: 'px',\n    left: 'px',\n    right: 'px',\n    bottom: 'px',\n    width: 'px',\n    height: 'px',\n    translate: 'px',\n    rotate: 'deg',\n    skewX: 'deg',\n    skewY: 'deg',\n    borderRadius: 'px',\n  },\n  unify: function (k, v, u) {\n    var u = u || Q.defaults, d = u[k] || '';\n    return map(v, function (x) { return isFinite(x) ? x + d : x })\n  },\n  strip: function (k, v, u) {\n    var u = u || Q.defaults, d = u[k], n = d && d.length;\n    if (d)\n      return map(v, function (x) { return x.substr(-n) == d ? parseFloat(x) : x })\n    return v;\n  },\n  each: function (ks, o, u) {\n    return map(ks, function (k) { return Q.unify(k, o[k], u) })\n  },\n  rect: function (b, u) {\n    return 'rect(' + Q.each(['top', 'right', 'bottom', 'left'], b, u) + ')'\n  },\n  calc: function (a, o) {\n    return 'calc(' + [].concat(a).join(' ' + (o || '-') + ' ') + ')'\n  },\n  url: function (a) {\n    return 'url(' + a + ')'\n  }\n})\n\nfunction Box(d, e) {\n  this.x = def(def(d.x, d.left), e ? -Inf : 0)\n  this.y = def(def(d.y, d.top), e ? -Inf : 0)\n  this.w = def(def(d.w, d.width), e ? Inf : 0)\n  this.h = def(def(d.h, d.height), e ? Inf : 0)\n}\nBox.prototype = {\n  constructor: Box,\n  get width() { return this.w },\n  get height() { return this.h },\n  get left() { return this.x },\n  get top() { return this.y },\n  get midX() { return add(this.x, this.w / 2) },\n  get midY() { return add(this.y, this.h / 2) },\n  get right() { return add(this.x, this.w) },\n  get bottom() { return add(this.y, this.h) },\n  grid: function (fun, acc, opts) {\n    var o = up({rows: 1, cols: 1}, opts)\n    var r = o.rows, c = o.cols;\n    var x = this.x, y = this.y, w = this.w / c, h = this.h / r;\n    var z = new Box({x: x, y: y, w: w, h: h})\n    for (var i = 0, n = 0; i < r; i++)\n      for (var j = 0; j < c; j++, n++)\n        acc = fun.call(this, acc, z.shift(w * j, h * i), i, j, n, z)\n    return acc;\n  },\n  join: function (boxs) {\n    var boxs = [].concat(boxs)\n    var bnds = boxs.reduce(function (a, b) {\n      return {x: min(a.x, b.x), y: min(a.y, b.y), right: max(a.right, b.right), bottom: max(a.bottom, b.bottom)}\n    }, this)\n    return new Box({x: bnds.x, y: bnds.y, w: bnds.right - bnds.x, h: bnds.bottom - bnds.y})\n  },\n  tile: function (fun, acc, opts) {\n    return this.grid(fun, acc, this.count(opts && opts.unit))\n  },\n  stack: function (fun, acc, opts) {\n    return this.times(opts).grid(fun, acc, opts)\n  },\n  count: function (box) {\n    var u = box || this;\n    return {rows: this.h / u.h, cols: this.w / u.w}\n  },\n  times: function (shape) {\n    var s = up({rows: 1, cols: 1}, shape)\n    return this.copy({w: s.cols * this.w, h: s.rows * this.h})\n  },\n  over: function (shape) {\n    var s = up({rows: 1, cols: 1}, shape)\n    return this.copy({w: this.w / s.cols, h: this.h / s.rows})\n  },\n  split: function (opts) {\n    return this.grid(function (acc, box) { return acc.push(box), acc }, [], opts)\n  },\n  align: function (box, ax, ay) {\n    var nx = (ax || 0) / 2, ny = (ay || 0) / 2, ox = nx + .5, oy = ny + .5;\n    var x = box.midX + nx * box.w - ox * this.w;\n    var y = box.midY + ny * box.h - oy * this.h;\n    return this.copy({x: x, y: y})\n  },\n  center: function (cx, cy) {\n    return this.copy({x: (cx || 0) - this.w / 2, y: (cy || 0) - this.h / 2})\n  },\n  xy: function (x, y) {\n    return this.copy({x: x || 0, y: y || 0})\n  },\n  scale: function (a, b) {\n    var w = a * this.w, h = def(b, a) * this.h;\n    return new Box({x: this.midX - w / 2, y: this.midY - h / 2, w: w, h: h})\n  },\n  shift: function (dx, dy) {\n    return this.copy({x: this.x + (dx || 0), y: this.y + (dy || 0)})\n  },\n  square: function (big) {\n    var o = big ? max : min, d = o(this.w, this.h)\n    return this.copy({w: d, h: d})\n  },\n  slice: function (ps, hzn) {\n    var d = hzn ? this.w : this.h, ps = [].concat(ps)\n    var f = 1 - ps.reduce(function (s, p) { return isFinite(p) ? s + p : s }, 0) / d;\n    return this.part(ps.map(function (p) {\n      var pct = typeof(p) == 'string' && p[p.length - 1] == '%';\n      return pct ? f * parseFloat(p.slice(0, -1)) / 100 : p / d;\n    }), hzn)\n  },\n  part: function (ps, hzn) {\n    var b = this, ko = hzn ? 'x' : 'y', kd = hzn ? 'w' : 'h';\n    var o = b[ko], u = {}, s = 0, ps = [].concat(ps, undefined)\n    return ps.map(function (p) {\n      u[ko] = (o += u[kd] || 0)\n      u[kd] = def(p, 1 - s) * b[kd]\n      s += p;\n      return b.copy(u)\n    })\n  },\n  pad: function (t, r, b, l) {\n    return this.trim(-t, -r, -b, -l)\n  },\n  trim: function (t, r, b, l) {\n    var t = def(t, 0), r = def(r, t), b = def(b, t), l = def(l, r)\n    return new Box({x: this.x + l, y: this.y + t, w: this.w - r - l, h: this.h - t - b})\n  },\n  copy: function (o) {\n    var o = o || {}, ow = def(o.w, o.width), oh = def(o.h, o.height)\n    with (this)\n      return new Box({x: def(o.x, x), y: def(o.y, y), w: def(ow, w), h: def(oh, h)})\n  },\n  equals: function (o) {\n    var o = o || {}, ow = def(o.w, o.width), oh = def(o.h, o.height)\n    with (this)\n      return x == def(o.x, 0) && y == def(o.y, 0) && w == def(ow, 0) && h == def(oh, 0)\n  },\n  toString: function () { with (this) return x + ',' + y + ',' + w + ',' + h }\n}\nBox.solve = function (opts) {\n  var o = up({}, opts)\n  var b = o.bbox, s = o.shape, u = o.unit;\n  if (b && s)\n    return up(o, {shape: up({rows: 1, cols: 1}, s), unit: b.over(s)})\n  if (u && s)\n    return up(o, {shape: up({rows: 1, cols: 1}, s), bbox: u.times(s)})\n  if (b && u)\n    return up(o, {shape: b.count(u), unit: u.copy({x: b.x, y: b.y})})\n}\n\nfunction RGB(d) { up(this, d) }\nRGB.mix = function (x, opts) {\n  var o = up({min: 0, max: 100, lo: {b: 100}, hi: {r: 100}}, opts)\n  var m = o.min, M = o.max, lo = o.lo, hi = o.hi;\n  function w(a, b) { return ((b || 0) * max(x - m, 0) + (a || 0) * max(M - x, 0)) / (M - m) }\n  function i(a, b) { return Math.round(w(a, b)) }\n  if (lo.a == undefined && hi.a == undefined)\n    return new RGB({r: i(lo.r, hi.r), g: i(lo.g, hi.g), b: i(lo.b, hi.b)})\n  return new RGB({r: i(lo.r, hi.r), g: i(lo.g, hi.g), b: i(lo.b, hi.b), a: w(lo.a, hi.a)})\n}\nRGB.random = function () {\n  return new RGB({r: util.randInt(0, 255), g: util.randInt(0, 255), b: util.randInt(0, 255)})\n}\nRGB.prototype.update = function (obj) { return up(this, obj) }\nRGB.prototype.update({\n  alpha: function (a) { return a == undefined ? this : this.update({a: a}) },\n  shift: function (x) {\n    function w(v) { return util.clip(v + x, 0, 255) }\n    return (new RGB({r: w(this.r || 0), g: w(this.g || 0), b: w(this.b || 0)})).alpha(this.a)\n  },\n  toString: function () {\n    if (this.a == undefined)\n      return 'rgb(' + (this.r || 0) + ',' + (this.g || 0) + ',' + (this.b || 0) + ')';\n    return 'rgba(' + (this.r || 0) + ',' + (this.g || 0) + ',' + (this.b || 0) + ',' + this.a + ')';\n  }\n})\n\nfunction elem(e, a, p, d) { return new Elem(e, a, p, d) }\nfunction Elem(elem, attrs, props, doc) {\n  this.node = elem && elem.nodeType ? elem : (doc || document).createElementNS(this.xmlns, elem)\n  this.attrs(attrs)\n  this.props(props)\n}\nElem.prototype.update = function (obj) { return up(this, obj) }\nElem.prototype.update({\n  xml: \"http://www.w3.org/XML/1998/namespace\",\n  xmlns: \"http://www.w3.org/1999/xhtml\",\n  addTo: function (parent) {\n    return (parent.node || parent).appendChild(this.node), this;\n  },\n  append: function (child) {\n    return child.addTo(this), this;\n  },\n  child: function (elem, attrs, props) {\n    return new this.constructor(elem, attrs, props).addTo(this)\n  },\n  clear: function () {\n    var n = this.node;\n    while (n.firstChild)\n      n.removeChild(n.firstChild)\n    return this;\n  },\n  order: function (k) {\n    var n = this.node, p = n.parentNode, C = p.childNodes.length;\n    p.insertBefore(n, p.childNodes[util.clip(k < 0 ? C + k : k, 0, C)])\n    return this;\n  },\n  remove: function () {\n    var n = this.node, p = n.parentNode;\n    if (p)\n      p.removeChild(n)\n    return this;\n  },\n\n  $: function (q) {\n    return wrap(typeof(q) == 'string' ? this.node.querySelector(q) : q)\n  },\n  doc: function () {\n    return this.node.ownerDocument ? new Elem(this.node.ownerDocument) : this;\n  },\n  each: function (sel, fun, acc) {\n    return [].reduce.call(this.node.querySelectorAll(sel), fun, acc) || this;\n  },\n  parent: function () {\n    return wrap(this.node.parentNode)\n  },\n  root: function () {\n    for (var n = this.node; n.parentNode; n = n.parentNode) {}\n    return n;\n  },\n  attached: function (o) {\n    return this.root() == (o ? o.root() : this.doc().node)\n  },\n  detached: function (o) {\n    return !this.attached(o)\n  },\n  unique: function (q, fun) {\n    return this.$(q) || fun(this)\n  },\n\n  hide: function (b) { return this.attrs({hidden: b || b == undefined ? '' : null}) },\n  show: function (b) { return this.attrs({hidden: b || b == undefined ? null : ''}) },\n  attr: function (name, ns) {\n    return this.node.getAttributeNS(ns || null, name)\n  },\n  attrs: function (attrs, ns) {\n    for (var k in attrs) {\n      var v = attrs[k]\n      if (v == null)\n        this.node.removeAttributeNS(ns || null, k)\n      else\n        this.node.setAttributeNS(ns || null, k, v)\n    }\n    return this;\n  },\n  props: function (props) {\n    for (var k in props)\n      this.node[k] = props[k]\n    return this;\n  },\n  style: function (attrs) {\n    for (var k in attrs)\n      this.node.style[k] = attrs[k]\n    return this;\n  },\n\n  space: function (space) {\n    return this.attrs({space: space}, this.xml)\n  },\n  txt: function (text, order) {\n    if (isFinite(order))\n      return elem(this.doc().node.createTextNode(text)).addTo(this).order(order), this;\n    return this.props({textContent: text})\n  },\n  uid: function () {\n    var id = (new Date - 0) + Math.random() + ''\n    return this.attrs({id: id}), id;\n  },\n  url: function () {\n    return Q.url('#' + (this.attr('id') || this.uid()))\n  },\n\n  addClass: function (cls) {\n    var node = this.node;\n    map(cls, function (c) { node.classList.add(c) })\n    return this;\n  },\n  hasClass: function (cls) {\n    return this.node.classList.contains(cls)\n  },\n  removeClass: function (cls) {\n    var node = this.node;\n    map(cls, function (c) { node.classList.remove(c) })\n    if (!node.classList.length)\n      node.removeAttribute('class')\n    return this;\n  },\n  css: function (k) {\n    var css = getComputedStyle(this.node)\n    return k ? css[k] : css;\n  },\n  addRules: function (rules) {\n    var i = 0, sheet = this.node.sheet;\n    for (var selector in rules) {\n      var rule = rules[selector], str = ''\n      for (var property in rule)\n        str += property + ': ' + rule[property] + ';'\n      sheet.insertRule(selector + '{' + str + '}', i++)\n    }\n    return i;\n  },\n\n  animate: function (fun, n) {\n    var self = this, i = 0;\n    var anim = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;\n    anim(function () {\n      if (fun.call(self, self.node, i++) || i < n)\n        anim(arguments.callee)\n    })\n    return this;\n  },\n  bind: function (name) {\n    var fun = this[name]\n    return fun.bind.apply(fun, [this].concat([].slice.call(arguments, 1)))\n  },\n\n  on: function (types, fun, capture) {\n    var node = this.node;\n    types.split(/\\s+/).map(function (type) {\n      node.addEventListener(type, fun, capture)\n    })\n    return this;\n  },\n  off: function (types, fun, capture) {\n    var node = this.node;\n    types.split(/\\s+/).map(function (type) {\n      node.removeEventListener(type, fun, capture)\n    })\n    return this;\n  },\n  trigger: function (type, data, opts) {\n    this.node.dispatchEvent(new CustomEvent(type, up({detail: data}, opts)))\n    return this;\n  },\n  upon: function (types, fun, capture) {\n    var f = function (e) { return fun.call(this, e, e.detail) }\n    return this.on(types, f, capture) && f;\n  },\n  once: function (types, fun) {\n    var n = 0;\n    return this.til(types, fun, function () { return n++ })\n  },\n  til: function (types, fun, dead) {\n    var self = this;\n    self.on(types, function () {\n      if (dead())\n        self.off(types, arguments.callee)\n      else\n        fun.apply(this, arguments)\n    })\n  },\n\n  svg: function (attrs, props) {\n    return svg(up({class: 'svg'}, attrs), props).addTo(this)\n  },\n  link: function (href) {\n    return this.child('a').href(href)\n  },\n  para: function (text) {\n    return this.child('p').txt(text)\n  },\n  div: function (attrs, props) {\n    return this.child('div', attrs, props)\n  },\n  span: function (attrs, props) {\n    return this.child('span', attrs, props)\n  },\n  form: function (attrs, props) {\n    return this.child('form', attrs, props)\n  },\n  input: function (attrs, props) {\n    return this.child('input', attrs, props)\n  },\n  image: function (x, y, w, h, href, u) {\n    return this.child('img', {class: 'image'}).attrs({src: href}).xywh(x, y, w, h, u)\n  },\n  circle: function (cx, cy, r, u) {\n    return this.div({class: 'circle'}).xywh(cx - r, cy - r, 2 * r, 2 * r, u).style(Q({borderRadius: r}, u))\n  },\n  ellipse: function (cx, cy, rx, ry, u) {\n    return this.div({class: 'ellipse'}).xywh(cx - rx, cy - ry, 2 * rx, 2 * ry, u).style({borderRadius: Q.unify('borderRadius', [rx, ry], u).join(' / ')})\n  },\n  rect: function (x, y, w, h, u) {\n    return this.div({class: 'rect'}).xywh(x, y, w, h, u)\n  },\n  text: function (x, y, text, u) {\n    return this.span({class: 'text'}).xy(x, y, u).txt(text)\n  },\n  g: function (attrs, props) {\n    return this.div(attrs, props)\n  },\n  icon: function (x, y, w, h, href, u) {\n    return this.svgX(Sky.box(x, y, w, h), u).attrs({class: 'icon'}).icon(x, y, w, h, href)\n  },\n\n  svgX: function (box, u) {\n    return this.svg({viewBox: box}).resize(box, u)\n  },\n  iconX: function (box, href, u) {\n    with (box || this.bbox())\n      return this.icon(x, y, w, h, href, u)\n  },\n  imageX: function (box, href, u) {\n    with (box || this.bbox())\n      return this.image(x, y, w, h, href, u)\n  },\n  circleX: function (box, p, big, u) {\n    var o = big ? max : min;\n    with (box || this.bbox())\n      return this.circle(midX, midY, def(p, 1) * o(w, h) / 2, u)\n  },\n  ellipseX: function (box, px, py, u) {\n    with (box || this.bbox())\n      return this.ellipse(midX, midY, def(px, 1) * w / 2, def(py, 1) * h / 2, u)\n  },\n  rectX: function (box, u) {\n    with (box || this.bbox())\n      return this.rect(x, y, w, h, u)\n  },\n  textX: function (box, text, ax, ay, u) {\n    return this.text(0, 0, text, u).align(box || this.bbox(), ax, ay)\n  },\n\n  anchor: function (i, j) {\n    var a = i < 0 ? 0 : (i > 0 ? -100 : -50)\n    var b = j < 0 ? 0 : (j > 0 ? -100 : -50)\n    return this.transform({translate: [a + '%', b + '%']})\n  },\n  bbox: function () {\n    return (new Box(this.node.getBoundingClientRect())).shift(pageXOffset, pageYOffset)\n  },\n  polar: function (r, a) {\n    return [r * trig.cos(a), r * trig.sin(a)]\n  },\n  href: function (href) {\n    return this.attrs({href: href})\n  },\n  xy: function (x, y, u) {\n    return this.style(Q({left: x, top: y}, u))\n  },\n  xywh: function (x, y, w, h, u) {\n    return this.style(Q({left: x, top: y, width: w, height: h}, u))\n  },\n  align: function (box, ax, ay, u) {\n    return this.place(Sky.box().align(box, ax, ay), u).anchor(ax, ay)\n  },\n  place: function (box, u) {\n    return this.parent().xy.call(this, box.x, box.y, u)\n  },\n  resize: function (box, u) {\n    return this.parent().xywh.call(this, box.x, box.y, box.w, box.h, u)\n  },\n  screen: function (x, y) {\n    return {x: x, y: y}\n  },\n  shift: function (dx, dy) {\n    var x = this.transformation(), t = x.translate = x.translate || [0, 0]\n    t[0] += dx || 0;\n    t[1] += dy || 0;\n    return this.transform(x)\n  },\n\n  transform: function (desc, u) {\n    var xform = []\n    for (var k in desc)\n      xform.push(k + '(' + Q.unify(k, [].concat(desc[k]), u).join(',') + ')')\n    xform = xform.join(' ')\n    return this.style({transform: xform,\n                       '-moz-transform': xform,\n                       '-ms-transform': xform,\n                       '-o-transform': xform,\n                       '-webkit-transform': xform})\n  },\n  transformation: function (val, u) {\n    var s = this.node.style, val = val ||\n        s['transform'] ||\n        s['-webkit-transform'] ||\n        s['-o-transform'] ||\n        s['-ms-transform'] ||\n        s['-moz-transform'] || '';\n    var m, p = /(\\w+)\\(([^\\)]*)\\)/g, tx = {}\n    while (m = p.exec(val)) {\n      var k = m[1], v = m[2].split(',')\n      tx[k] = Q.strip(k, v, u)\n    }\n    return tx;\n  }\n})\n\nfunction svg(a, p, d) { return new SVGElem('svg', a, p, d) }\nfunction SVGElem() {\n  Elem.apply(this, arguments)\n}\nSVGElem.prototype = new Elem().update({\n  constructor: SVGElem,\n  xmlns: \"http://www.w3.org/2000/svg\",\n  xlink: \"http://www.w3.org/1999/xlink\",\n  svg: function (attrs, props) {\n    return this.child('svg', attrs, props)\n  },\n  circle: function (cx, cy, r) {\n    return this.child('circle', {cx: cx, cy: cy, r: r})\n  },\n  ellipse: function (cx, cy, rx, ry) {\n    return this.child('ellipse', {cx: cx, cy: cy, rx: rx, ry: ry})\n  },\n  line: function (x1, y1, x2, y2) {\n    return this.child('line', {x1: x1, y1: y1, x2: x2, y2: y2})\n  },\n  path: function (d) {\n    return this.child('path', d && {d: d})\n  },\n  polyline: function (points) {\n    return this.child('polyline', {points: points})\n  },\n  polygon: function (points) {\n    return this.child('polygon', {points: points})\n  },\n  rect: function (x, y, w, h) {\n    return this.child('rect', {x: x, y: y, width: w, height: h})\n  },\n  text: function (x, y, text) {\n    return this.child('text', {x: x, y: y}, {textContent: text})\n  },\n  tspan: function (text) {\n    return this.child('tspan', {}, {textContent: text})\n  },\n  g: function (attrs, props) {\n    return this.child('g', attrs, props)\n  },\n  image: function (x, y, w, h, href) {\n    return this.child('image').href(href).xywh(x, y, w, h)\n  },\n  use: function (href) {\n    return this.child('use').href(href)\n  },\n  mask: function (attrs, props) {\n    return this.child('mask', attrs, props)\n  },\n  clipPath: function (attrs, props) {\n    return this.child('clipPath', attrs, props)\n  },\n  icon: function (x, y, w, h, href) {\n    return this.use(href).xywh(x, y, w, h)\n  },\n\n  border: function (t, r, b, l, box) {\n    return this.path(P.border(box || this.bbox(), t, r, b, l))\n  },\n\n  anchor: function (i, j) {\n    var a = i < 0 ? 'start' : (i > 0 ? 'end' : 'middle')\n    var b = j < 0 ? 'hanging' : (j > 0 ? 'alphabetic' : 'central')\n    return this.attrs({'text-anchor': a, 'dominant-baseline': b})\n  },\n  bbox: function () {\n    return new Box(this.node.getBBox())\n  },\n  enc: function () {\n    return this.node.tagName == 'svg' ? this : new SVGElem(this.node.ownerSVGElement)\n  },\n  fit: function () {\n    return this.enc().attrs({viewBox: this.bbox()})\n  },\n  href: function (href) {\n    return this.attrs({href: href}, this.xlink)\n  },\n  xy: function (x, y) {\n    return this.attrs({x: x, y: y})\n  },\n  xywh: function (x, y, w, h) {\n    return this.attrs({x: x, y: y, width: w, height: h})\n  },\n  point: function (x, y) {\n    var p = this.enc().node.createSVGPoint()\n    p.x = x;\n    p.y = y;\n    return p;\n  },\n  screen: function (x, y) {\n    return this.point(x, y).matrixTransform(this.node.getScreenCTM())\n  },\n\n  transform: function (desc) {\n    var xform = []\n    for (var k in desc)\n      xform.push(k + '(' + [].concat(desc[k]).join(',') + ')')\n    return this.attrs({transform: xform.join(' ')})\n  },\n  transformation: function (list) {\n    var tx = {}, list = list || this.node.transform.baseVal;\n    for (var i = 0; i < list.numberOfItems; i++) {\n      var t = list.getItem(i), m = t.matrix;\n      if (t.type == SVGTransform.SVG_TRANSFORM_MATRIX)\n        tx.matrix = [m.a, m.b, m.c, m.d, m.e, m.f]\n      else if (t.type == SVGTransform.SVG_TRANSFORM_TRANSLATE)\n        tx.translate = [m.e, m.f]\n      else if (t.type == SVGTransform.SVG_TRANSFORM_SCALE)\n        tx.scale = [m.a, m.d]\n      else if (t.type == SVGTransform.SVG_TRANSFORM_ROTATE)\n        tx.rotate = [t.angle, (m.f / m.c + m.e) / m.a, (m.e / m.b - m.f) / m.a]\n      else if (t.type == SVGTransform.SVG_TRANSFORM_SKEWX)\n        tx.skewX = t.angle;\n      else if (t.type == SVGTransform.SVG_TRANSFORM_SKEWY)\n        tx.skewY = t.angle;\n    }\n    return tx;\n  }\n})\n\nvar Sky = module.exports = {\n  $: function (q) { return new Elem(document).$(q) },\n  box: function (x, y, w, h) { return new Box({x: x, y: y, w: w, h: h}) },\n  rgb: function (r, g, b, a) { return new RGB({r: r, g: g, b: b, a: a}) },\n  elem: elem,\n  svg: svg,\n  util: util,\n  path: path,\n  units: units,\n  Box: Box,\n  RGB: RGB,\n  Elem: Elem,\n  SVGElem: SVGElem\n}\n","var up = function (a, b) {\n  for (var k in b)\n    a[k] = b[k]\n  return a;\n}\nvar cls = function (cons) {\n  [].slice.call(arguments, 1).map(function (base) { up(cons.prototype, base) })\n  return cons;\n}\nvar int = function (x) { return parseInt(x, 10) }\nvar sgn = function (x) { return x < 0 ? -1 : 1 }\nvar pow = function (x, a) { return sgn(x) * Math.pow(Math.abs(x), a || 2) }\nvar add = function (x, y) { return x + y }\nvar max = function (x, y) { return x > y ? x : y }\nvar min = function (x, y) { return x < y ? x : y }\nvar mod = function (x, y) {\n  var r = x % y;\n  return r < 0 ? r + y : r;\n}\nvar pad = function (s, opt) {\n  var s = s + '', w = opt && opt.width || 2, p = opt && opt.pad || '0';\n  while (s.length < w)\n    s = p + s;\n  return s;\n}\nvar item = function (v) {\n  if (v instanceof Array)\n    return v;\n  return [v, true]\n}\nvar nchoosek = function (n, k) {\n  var c = 1, d = 1;\n  for (var i = n; i > k; i--) {\n    c *= i;\n    d *= n - i + 1;\n  }\n  return c / d;\n}\nvar bezier = function (t, P) {\n  var n = P.length - 1, x = 0, y = 0;\n  for (i = 0; i <= n; i++) {\n    var p = P[i], w = nchoosek(n, i) * Math.pow(1 - t, n - i) * Math.pow(t, i)\n    x += w * (p[0] || 0)\n    y += w * (p[1] || 0)\n  }\n  return [x, y]\n}\n\nvar Sun = module.exports = {\n  up: up,\n  cls: cls,\n  int: int,\n  sgn: sgn,\n  pow: pow,\n  add: add,\n  max: max,\n  min: min,\n  mod: mod,\n  pad: pad,\n  item: item,\n  nchoosek: nchoosek,\n  bezier: bezier,\n\n  clockdist: function (a, b, c) {\n    return min(mod(a - b, c || 24), mod(b - a, c || 24))\n  },\n\n  ellipsis: function (text, n) {\n    if (n && text.length > n + 3)\n      return text.substr(0, n) + '\\u2026';\n    return text;\n  },\n\n  equals: function (a, b) {\n    if (a || b) {\n      if (a && b) {\n        for (var k in a)\n          if (a[k] != b[k])\n            return false;\n        for (var k in b)\n          if (b[k] != a[k])\n            return false;\n        return true;\n      }\n      return false;\n    }\n    return true;\n  },\n\n  count: function (fun, acc, opt) {\n    var o = up({start: 0, step: 1, stop: isFinite(opt) ? opt : undefined}, opt)\n    var f = o.start + o.step >= o.start;\n    for (var i = o.start; f ? i < o.stop : i > o.stop; i += o.step)\n      acc = fun(acc, i, o)\n    return acc;\n  },\n  range: function (opt) {\n    return Sun.count(L.append, [], opt)\n  },\n\n  fold: function (fun, acc, obj) {\n    var i = 0;\n    if (obj instanceof Array)\n      for (var k in obj)\n        acc = fun(acc, item(obj[k]), i++, obj)\n    else\n      for (var k in obj)\n        acc = fun(acc, [k, obj[k]], i++, obj)\n    return acc;\n  },\n\n  format: function (fmt, arg) {\n    return fmt.replace(/{(.*?)}/g, function(m, k) { return k in arg ? arg[k] : m })\n  },\n\n  keyfun: function (key) {\n    if (key instanceof Function)\n      return key;\n    if (key == undefined)\n      return function (item) { return item }\n    return function (item) { return item[key] }\n  },\n\n  lookup: function (obj, path) {\n    var path = L(path)\n    return path.reduce(function (acc, k) {\n      if (acc)\n        return acc[k]\n      return acc;\n    }, obj)\n  },\n\n  modify: function (obj, path, fun) {\n    var path = L(path)\n    var pen = Sun.lookup(obj, path.slice(0, -1)), k = L.last(path)\n    if (pen && path.length)\n      pen[k] = fun(pen[k])\n    return obj;\n  },\n\n  object: function (iter, def) {\n    return Sun.fold(function (o, i) {\n      var k = i[0], v = i[1]\n      if (v === undefined)\n        v = def;\n      if (v !== undefined)\n        o[k] = v;\n      return o;\n    }, {}, iter)\n  },\n\n  select: function (obj, iter) {\n    return Sun.fold(function (o, i) {\n      var k = i[0], v = obj[k]\n      if (v !== undefined)\n        o[k] = v;\n      return o;\n    }, {}, iter)\n  },\n\n  repeat: function (fun, every) {\n    return fun() || setTimeout(function () {\n      fun() || setTimeout(arguments.callee, every)\n    }, every)\n  },\n  throttle: function (fun, every, T) {\n    return function () {\n      clearTimeout(T)\n      T = setTimeout(fun.bind.apply(fun, L.concat(this, arguments)), every)\n    }\n  }\n}\n\nSun.Cage = function Cage(obj, opt) {\n  this.__opt__ = up({sep: /\\s+/}, opt)\n  this.__obj__ = obj || this;\n  this.__fns__ = {}\n  return this;\n}\nup(Sun.Cage.prototype, {\n  get: function (k, d) {\n    if (k in this.__obj__)\n      return this.__obj__[k]\n    return d;\n  },\n\n  change: function (k, v) {\n    var u = this.__obj__[k]\n    this.__obj__[k] = v;\n    this.trigger(k, v, u)\n    return v;\n  },\n  update: function (obj) {\n    for (var k in obj)\n      this.change(k, obj[k])\n    return this;\n  },\n\n  on: function (keys, fun) {\n    var fns = this.__fns__, sep = this.__opt__.sep;\n    keys.split(sep).map(function (k) { (fns[k] = fns[k] || []).push(fun) })\n    return this;\n  },\n  off: function (keys, fun) {\n    var fns = this.__fns__, sep = this.__opt__.sep;\n    keys.split(sep).map(function (k) {\n      var i = (fns[k] || []).indexOf(fun)\n      if (i >= 0)\n        delete fns[k][i]\n    })\n    return this;\n  },\n  once: function (keys, fun) {\n    var n = 0;\n    return this.til(keys, fun, function () { return n++ })\n  },\n  til: function (keys, fun, dead) {\n    this.on(keys, function () {\n      if (dead())\n        this.off(keys, arguments.callee)\n      else\n        fun.apply(this, arguments)\n    })\n  },\n  trigger: function (key, val, old) {\n    var self = this;\n    return (self.__fns__[key] || []).map(function (f) { f.call(self, val, old, key) })\n  }\n})\n\nSun.URL = {\n  format: function (url) {\n    var str = ''\n    if (url.scheme)\n      str += url.scheme + ':'\n    if (url.authority)\n      str += '//' + url.authority;\n    if (url.path)\n      str += url.path;\n    if (url.query)\n      str += '?' + url.query;\n    if (url.fragment)\n      str += '#' + url.fragment;\n    return str;\n  }\n}\n\nSun.form = {\n  encode: function (obj) {\n    var list = []\n    for (var k in obj)\n      list.push(encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]));\n    return list.join('&');\n  },\n  decode: function (str) {\n    var list = str ? str.split('&') : []\n    return list.reduce(function (acc, item) {\n      var kv = item.split('=').map(decodeURIComponent);\n      acc[kv[0]] = kv[1]\n      return acc;\n    }, {});\n  }\n}\n\nvar H = Sun.http = up(function (method, url, fun, data, hdrs) {\n  var req = new XMLHttpRequest()\n  req.onreadystatechange = function () {\n    if (this.readyState == this.DONE){\n      fun(this)\n    }\n  }\n  req.open(method, url, true)\n  Sun.fold(function (_, o) { req.setRequestHeader(o[0], o[1]) }, null, hdrs)\n  req.send(data)\n  return req;\n}, {\n  get:  function (url, fun, hdrs)       { return H(\"GET\",  url, fun, null, hdrs) },\n  put:  function (url, fun, data, hdrs) { return H(\"PUT\",  url, fun, data, hdrs) },\n  post: function (url, fun, data, hdrs) { return H(\"POST\", url, fun, data, hdrs) }\n})\n\nvar L = Sun.list = up(function (x) {\n  return x instanceof Array ? x : [x]\n}, {\n  last: function (list, n) { return list[list.length - (n || 1)] },\n  append: function (list, item) { return list.push(item) && list },\n  concat: function (item, list) { return [item].concat([].slice.call(list)) },\n  drop: function (list, item) {\n    var i = list.indexOf(item)\n    if (i >= 0)\n      return list.splice(i, 1)[0]\n  },\n  fold: function(list, fun, acc) {\n    for (var i = 0; i < list.length; i++)\n      acc = fun(acc, list[i], i, list)\n    return acc;\n  },\n  groupby: function (list, key) {\n    var k, key = key || function (item) { return item[0] }\n    return L.fold(list, function (acc, item) {\n      var k_ = key(item)\n      if (k_ == k)\n        acc[acc.length - 1][1].push(item)\n      else\n        acc.push([k_, [item]])\n      k = k_;\n      return acc;\n    }, [])\n  },\n  unique: function (list, key) {\n    var keys = {}, key = key || function (item) { return item }\n    return L.fold(list, function (acc, item) {\n      var k = key(item)\n      if (k in keys)\n        return acc;\n      keys[k] = true;\n      return acc.push(item), acc;\n    }, [])\n  },\n  insert: function (list, item, lte) {\n    var lte = lte || function (a, b) { return a <= b }\n    for (var i = 0; i < list.length; i++)\n      if (lte(item, list[i]))\n        return list.splice(i, 0, item) && list;\n    return list.push(item) && list;\n  },\n\n  keyindex: function (list, val, key, eq) {\n    var eq = eq || function (a, b) { return a <= b && a >= b }\n    var key = Sun.keyfun(key)\n    for (var i = 0; i < list.length; i++) {\n      var v = key(list[i])\n      if (eq(v, val))\n        return i;\n    }\n  },\n  keydrop: function (list, val, key, eq) {\n    var i = L.keyindex(list, val, key, eq)\n    if (i >= 0)\n      return list.splice(i, 1)[0]\n  },\n  keymodify: function (list, val, fun, key, eq) {\n    var i = L.keyindex(list, val, key, eq)\n    if (i >= 0)\n      return list[i] = fun(list[i])\n    return list.push(fun()), L.last(list)\n  },\n\n  times: function (list, n) {\n    var l = []\n    for (var i = 0; i < n; i++)\n      l = l.concat(list)\n    return l;\n  },\n  umerge: function (x, y, lt) {\n    var lt = lt || function (a, b) { return a < b }\n    var z = [], i = 0, j = 0, l;\n    while (i < x.length || j < y.length) {\n      if (j >= y.length || lt(x[i], y[j])) {\n        if (lt(l, x[i]) || !(i || j))\n          z.push(l = x[i])\n        i++;\n      }\n      else {\n        if (lt(l, y[j]) || !(i || j))\n          z.push(l = y[j])\n        j++;\n      }\n    }\n    return z;\n  },\n  values: function (obj) {\n    var vals = []\n    for (var k in obj)\n      vals.push(obj[k])\n    return vals;\n  }\n})\n\nvar Sec = 1000, Min = 60 * Sec, Hour = 60 * Min, Day = 24 * Hour, Week = 7 * Day;\nvar DoW = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']\nvar MoY = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\nvar T = Sun.time = up(function (set, rel) {\n  var rel = rel ? new Date(rel) : new Date, set = set || {}\n  return new Date(set.y == undefined ? rel.getFullYear() : set.y,\n                  set.m == undefined ? rel.getMonth() : set.m,\n                  set.d == undefined ? rel.getDate() : set.d,\n                  set.h == undefined ? rel.getHours() : set.h,\n                  set.mi == undefined ? rel.getMinutes() : set.mi,\n                  set.s == undefined ? rel.getSeconds() : set.s,\n                  set.ms == undefined ? rel.getMilliseconds() : set.ms)\n}, {\n  get: function (k, rel) {\n    var rel = rel ? new Date(rel) : new Date;\n    switch (k) {\n    case 'y': return rel.getFullYear()\n    case 'm': return rel.getMonth()\n    case 'd': return rel.getDate()\n    case 'h': return rel.getHours()\n    case 'mi': return rel.getMinutes()\n    case 's': return rel.getSeconds()\n    case 'ms': return rel.getMilliseconds()\n    }\n  },\n  pass: function (dif, rel) {\n    var rel = rel ? new Date(rel) : new Date;\n    for (var k in dif)\n      switch (k) {\n      case 'y': rel.setFullYear(rel.getFullYear() + dif[k]); break;\n      case 'm': rel.setMonth(rel.getMonth() + dif[k]); break;\n      case 'w': rel.setDate(rel.getDate() + dif[k] * 7); break;\n      case 'd': rel.setDate(rel.getDate() + dif[k]); break;\n      case 'h': rel.setHours(rel.getHours() + dif[k]); break;\n      case 'mi': rel.setMinutes(rel.getMinutes() + dif[k]); break;\n      case 's': rel.setSeconds(rel.getSeconds() + dif[k]); break;\n      case 'ms': rel.setMilliseconds(rel.getMilliseconds() + dif[k]); break;\n      }\n    return rel;\n  },\n  fold: function (fun, acc, opt) {\n    var t = opt.start || new Date, stop = opt.stop, step = opt.step || {d: 1}\n    var f = T.pass(step, t) >= t, jump = {}\n    for (var i = 1, s = t; !stop || (f ? (t < stop) : (t > stop)); i++) {\n      acc = fun(acc, t)\n      for (var k in step)\n        jump[k] = step[k] * i;\n      t = T.pass(jump, s)\n    }\n    return acc;\n  },\n  parse: function (stamp, opt) {\n    var opt = opt || {}\n    var sep = opt.sep || 'T', dsep = opt.dsep || '-', tsep = opt.tsep || ':';\n    var utc = opt.utc || stamp[stamp.length - 1] == 'Z';\n    var dtp = stamp.split(sep)\n    var datep = dtp[0] ? dtp[0].split(dsep).map(int) : [0, 0, 0]\n    var timep = dtp[1] ? dtp[1].substring(0, 8).split(':').map(int) : [0, 0, 0]\n    if (utc)\n      return new Date(Date.UTC(datep[0], datep[1] - 1, datep[2], timep[0], timep[1], timep[2]))\n    return new Date(datep[0], datep[1] - 1, datep[2], timep[0], timep[1], timep[2])\n  },\n  datestamp: function (t) {\n    return t.getFullYear() + '/' + pad(t.getMonth() + 1) + '/' + pad(t.getDate())\n  },\n  timestamp: function (t) {\n    return pad(t.getHours()) + ':' + pad(t.getMinutes()) + ':' + pad(t.getSeconds())\n  },\n  stamp: function (t) { return T.datestamp(t) + ' ' + T.timestamp(t) },\n  fromGregorian: function (s) { return new Date((s - 62167219200) * 1000) },\n  toGregorian: function (t) { return ~~(t / 1000) + 62167219200 },\n  daysInMonth: function (y, m) { return 32 - new Date(y, m, 32).getDate() },\n  isLeapYear: function (y) { return !(y % 4) && ((y % 100) != 0 || !(y % 400)) },\n  weekday: function (t) { return DoW[t.getDay()] },\n  month: function (t) { return MoY[t.getMonth()] },\n  DoW: DoW,\n  MoY: MoY,\n  Sec: Sec,\n  Min: Min,\n  Hour: Hour,\n  Day: Day,\n  Week: Week\n})\n","var Sky = require('../sky')\nvar Sun = require('../sun')\nvar Orb = require('./orb')\nvar fmt = Sun.format, up = Sun.up, mod = Sun.mod;\nvar log = Math.log, sqrt = Math.sqrt;\nvar asin = Math.asin, PI = Math.PI;\nvar haversin = function (d) { return sqr(sin(d / 2)) }\nvar deg = function (r) { return 180 / PI * r }\nvar rad = function (d) { return PI / 180 * d }\nvar cos = function (d) { return Math.cos(rad(d)) }\nvar sin = function (d) { return Math.sin(rad(d)) }\nvar tan = function (d) { return Math.tan(rad(d)) }\nvar sqr = function (x) { return x * x }\n\nfunction MTS(spec) {\n  this.spec = spec;\n  this.scheme = 'xyz';\n}\nup(MTS.prototype, {\n  href: function (x, y, z) { return fmt(this.spec, {x: x, y: y, z: z}) },\n  tile: function (x, y, z) { return y >= 0 ? this.href(mod(~~x, 1 << z), ~~y, z) : '' },\n  project: function (l, z) {\n    var z = z || 0, k = (1 << z) / 360;\n    var p = Geo.mercator(l.lat, l.lng)\n    var x = (p[0] + 180) * k, y = deg(PI - p[1]) * k;\n    return [x, y, z]\n  }\n})\n\nvar Geo = module.exports = {\n  haversine: function (lat, lng, lat_, lng_) {\n    return asin(sqrt(haversin(lat_ - lat) + cos(lat) * cos(lat_) * haversin(lng_ - lng)))\n  },\n  mercator: function (lat, lng) { return [lng, log(tan(45 + lat / 2))] },\n  mts: function (spec) { return new MTS(spec) },\n  MTS: MTS\n}\n\nSky.SVGElem.prototype.update({\n  map: Orb.type(function Map(parent, jack, opts) {\n    var opts = this.opts = up({center: {lat: 0, lng: 0}, zoom: 3, size: 256}, opts)\n    var dims = this.dims = opts.dims || parent.bbox()\n    var self = this, loops = [], overlay = [], markers = []\n    var elem = this.elem = parent.g(), tiles = elem.g()\n    var jack = this.jack = [loops, markers]\n\n    var s = opts.size, mts = opts.mts;\n    var c = dims.width / s, r = dims.height / s, C = Math.ceil(c) + 2, R = Math.ceil(r) + 2;\n    var p = mts.project(opts.center, opts.zoom)\n    var x = p[0], y = p[1], z = p[2]\n\n    var draw = function (x, y, z) {\n      var box = Sky.box(x - C / 2, y - R / 2, C, R)\n      elem.transform({scale: s, translate: [-(x - c / 2), -(y - r / 2)]})\n      tiles.clear()\n      overlay.map(function (o) {\n        var t = mts.project(o[0], z).slice(0, 2)\n        var g = o[1].transform({translate: t, scale: 1 / s})\n      })\n      return box.grid(function (a, b, i, j, k) {\n        var m = 0, n = 0;\n        var tile = tiles.g().transform({translate: [~~b.x, ~~b.y]})\n        var img = tile.image(0, 0, b.w, b.h, mts.tile(b.x, b.y, z))\n        var loop = tile.loop(null, {\n          bbox: box,\n          wrap: function (wx, wy) {\n            img.href(mts.tile(b.x + (m += wx * C), b.y + (n += wy * R), z))\n          }\n        })\n        return (a[k] = tile.wagon(loop)), a;\n      }, loops, {rows: R, cols: C})\n    }\n    draw(x, y, z)\n\n    this.move = function (dx, dy) {\n      var sx = dx / s, sy = dy / s;\n      x -= sx;\n      y -= sy;\n      Orb.move(jack, sx, sy)\n    }\n\n    this.goto = function (l) {\n      var d = mts.project(l || opts.center, z)\n      Orb.move(this, d[0] - x, d[1] - y)\n    }\n\n    this.zoom = function (dz) {\n      var dk = Math.pow(1 << Math.abs(dz), Sun.sgn(dz))\n      draw(x *= dk, y *= dk, z += dz)\n    }\n\n    this.add = function (f, l) {\n      var l = l || opts.center;\n      var t = mts.project(l, z).slice(0, 2)\n      var g = elem.g().transform({translate: t, scale: 1 / s})\n      var o = f.call(self, g)\n      overlay.push([l, g])\n      if (o)\n        markers.push(o)\n      return o;\n    }\n  })\n})\n","var Sky = require('../sky')\nvar U = Sky.util;\nvar def = U.def, fnt = U.fnt, clip = U.clip;\nvar pop = U.pop, up = U.update, ext = U.extend;\nvar abs = Math.abs, log = Math.log, rnd = Math.round, E = Math.E;\nvar min = Math.min, max = Math.max;\nvar sgn = function (x) { return x < 0 ? -1 : 1 }\nvar cat = function (a, b) { return b ? [].concat(a, b) : a }\nvar id = function (o) { return o }\nvar noop = function () {}\n\nvar touch = typeof(ontouchstart) != 'undefined';\nvar pointerdown = touch ? 'touchstart' : 'mousedown';\nvar pointermove = touch ? 'touchmove' : 'mousemove';\nvar pointerup = touch ? 'touchend touchcancel' : 'mouseup';\n\nvar Orb = function Orb(obj, jack, elem) {\n  this.jack = jack || this.jack;\n  this.elem = elem || this.elem;\n  this.grip = 0;\n  this.update(obj)\n}\nOrb.prototype.update = function (obj) { return up(this, obj) }\nOrb.prototype.update({\n  prop: function (f, a) { return Orb.do(this.jack, f, a) },\n  grab: function () { this.grip++; return this.prop('grab', arguments) },\n  free: function () { this.grip--; return this.prop('free', arguments) },\n  move: function () { return this.prop('move', arguments) },\n  push: function () { return this.prop('move', arguments) },\n  sync: function () { return this.prop('sync', arguments) },\n  drag: function (f, a) { return Orb.drag(this, f, a) },\n  walk: function (f, a) { return Orb.walk(this, f, a) },\n  thru: function (o, a) { return Orb.thru(this, o, a) }\n})\nOrb = module.exports = up(Orb, {\n  do: function (o, f, a) {\n    if (o) {\n      if (o[f])\n        return o[f].apply(o, a)\n      if (o instanceof Array)\n        return o.reduce(function (_, i) { return Orb.do(i, f, a) }, 0)\n    }\n  },\n  call: function (o, f) { return Orb.do(o, f, [].slice.call(arguments, 2)) },\n  grab: function (o) { return Orb.do(o, 'grab', [].slice.call(arguments, 1)) },\n  free: function (o) { return Orb.do(o, 'free', [].slice.call(arguments, 1)) },\n  move: function (o, dx, dy, a, r, g, s) {\n    return Orb.do(o, 'move', [dx || 0, dy || 0, a, r, g, s])\n      },\n  drag: function (o, f, a) {\n    return Orb.grab(o), Orb.do(o, f, a), Orb.free(o), o;\n  },\n  type: function (cons) {\n    var proto = cons.prototype = new Orb;\n    [].slice.call(arguments, 1).map(function (base) { up(proto, base) })\n    return function (a, r, g, s) { return new cons(this, a, r, g, s) }\n  },\n  walk: function (o, f, a) {\n    return f.call(o, o.parent ? Orb.walk(o.parent, f, a) : a)\n  },\n  thru: function (o, p, a) {\n    return a.map(function (k) {\n      Object.defineProperty(o, k, {get: function () { return p[k] }})\n    })\n  }\n})\n\nSky.Elem.prototype.update({\n  tap: function (fun, opts, jack) {\n    var opts = up({gap: 250, mx: 1, my: 1}, opts)\n    var open, Dx, Dy;\n    return this.swipe(this.orb({\n      grab: function (e) {\n        Dx = Dy = 0;\n        open = true;\n        setTimeout(function () { open = false }, opts.gap)\n        if (opts.stop)\n          e.stopImmediatePropagation()\n        Orb.prototype.grab.apply(this, arguments)\n      },\n      move: function (dx, dy) {\n        Dx += abs(dx)\n        Dy += abs(dy)\n        this.push(dx, dy)\n      },\n      free: function (e) {\n        if (open && Dx <= opts.mx && Dy <= opts.my)\n          fun && fun.apply(this, arguments)\n        open = false;\n        if (opts.stop)\n          e.stopImmediatePropagation()\n        Orb.prototype.free.apply(this, arguments)\n      }\n    }, jack), {stop: opts.stop})\n  },\n\n  dbltap: function (fun, opts) {\n    var opts = up({gap: 250}, opts)\n    var self= this, taps = 0;\n    this.on(pointerdown, function (e) {\n      if (taps++)\n        fun && fun.apply(self, arguments)\n      setTimeout(function () { taps = 0 }, opts.gap)\n      if (opts.prevent)\n        e.preventDefault()\n    })\n    return this;\n  },\n\n  press: function (o, opts) {\n    var opts = up({gain: 1, every: 1}, opts)\n    var i, doc = this.doc()\n    return this.on(pointerdown, function (e) {\n      Orb.grab(o, e)\n      i = setInterval(function () { Orb.move(o, opts.gain) }, opts.every)\n      if (opts.prevent)\n        e.preventDefault()\n      doc.once(pointerup, function (e) {\n        Orb.free(o, e)\n        clearInterval(i)\n        if (opts.prevent)\n          e.preventDefault()\n      })\n    })\n  },\n\n  swipe: function (o, opts) {\n    var opts = up({glob: true}, opts)\n    var lx, ly, move, doc = this.doc(), that = opts.glob ? doc : this;\n    this.on(pointerdown, function (e) {\n      var t = e.touches ? e.touches[0] : e;\n      Orb.grab(o, e)\n      lx = t.pageX;\n      ly = t.pageY;\n      if (opts.prevent)\n        e.preventDefault()\n      that.on(pointermove, move = function (e) {\n        var t = e.touches ? e.touches[0] : e;\n        Orb.move(o, t.pageX - lx, t.pageY - ly, lx, ly, e)\n        lx = t.pageX;\n        ly = t.pageY;\n        if (opts.stop)\n          e.stopImmediatePropagation()\n        if (opts.prevent)\n          e.preventDefault()\n      })\n      doc.once(pointerup, function (e) {\n        that.off(pointermove, move)\n        Orb.free(o, e)\n        if (opts.prevent)\n          e.preventDefault()\n      })\n    })\n    return this;\n  },\n\n  scroll: function (o, opts) {\n    var opts = up({prevent: true}, opts)\n    var lx, ly;\n    return this.on('mousewheel', function (e) {\n      Orb.move(o, e.wheelDeltaX, e.wheelDeltaY, lx, ly, e)\n      lx = e.pageX;\n      ly = e.pageY;\n      if (opts.stop)\n        e.stopImmediatePropagation()\n      if (opts.prevent)\n        e.preventDefault()\n    }).swipe(o, opts)\n  },\n\n  orb: function (obj, jack) {\n    return new Orb(obj, jack, this)\n  },\n\n  amp: Orb.type(function Amp(elem, jack, opts) {\n    var ax, ay, kx, ky;\n    var pow = Sun.pow;\n    var opts = up({ax: 1, ay: 1, kx: 1, ky: 1}, opts)\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy, a, r, g, s) {\n      this.push(kx * pow(dx, ax), ky * pow(dy, ay), a, r, g, s)\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      ax = opts.ax; ay = opts.ay;\n      kx = opts.kx; ky = opts.ky;\n    }\n    this.setOpts(opts)\n  }),\n\n  spring: Orb.type(function Spring(elem, jack, opts) {\n    var lock, kx, ky, lx, ly, tx, ty, restore, stretch, balance, perturb, anim;\n    var opts = up({}, opts)\n    this.dx = 0;\n    this.dy = 0;\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy) {\n      var s = this;\n      s.dx += lx * dx;\n      s.dy += ly * dy;\n      stretch && stretch.call(s)\n      if (!anim) {\n        perturb && perturb.call(s)\n        anim = elem.animate(function () {\n          var dx = s.dx, dy = s.dy, mx = abs(dx), my = abs(dy)\n          var more = restore.call(s, dx, dy, mx, my) || s.dx || s.dy || s.grip;\n          if (!more) {\n            anim = null;\n            balance && balance.call(s)\n          }\n          return more;\n        })\n      }\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      lock = opts.lock;\n      kx = opts.kx || 8; ky = opts.ky || 8;\n      lx = opts.lx || 1; ly = opts.ly || 1;\n      tx = opts.tx || 1; ty = opts.ty || 1;\n      restore = opts.restore || function (dx, dy, mx, my) {\n        if (lock && this.grip)\n          return;\n        if (mx > tx) dx /= kx * log(mx + 1)\n        if (my > ty) dy /= ky * log(my + 1)\n        this.dx -= dx;\n        this.dy -= dy;\n        return this.push(dx, dy, this)\n      }\n      stretch = opts.stretch;\n      balance = opts.balance;\n      perturb = opts.perturb;\n    }\n    this.setOpts(opts)\n  }),\n\n  guide: Orb.type(function Guide(elem, jack, opts) {\n    var unit, bbox, w, h, px, py, mx, my, balance, settle, truncate;\n    var dist = Sun.clockdist;\n    var opts = up({}, opts)\n    var self = this;\n    var spring = elem.spring(jack)\n    this.elem = elem;\n    this.jack = spring;\n    this.move = function (dx, dy) {\n      self.px = px += dx;\n      self.py = py += dy;\n      self.push(dx, dy)\n    }\n    this.goto = function (i, j) {\n      var ox = px + spring.dx - (i || 0) * w, oy = py + spring.dy - (j || 0) * h;\n      self.move(-ox, -oy)\n    }\n    this.slot = function () {\n      return [rnd((px + spring.dx) / w), rnd((py + spring.dy) / h)]\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      unit = pop(opts, 'unit', unit || {})\n      bbox = opts.bbox || elem.bbox()\n      w = def(unit.width, def(w, bbox.width))\n      h = def(unit.height, def(h, bbox.height))\n      px = self.px = opts.px || 0;\n      py = self.py = opts.py || 0;\n      mx = opts.mx || 1e-3;\n      my = opts.my || 1e-3;\n      balance = opts.balance;\n      settle = pop(opts, 'settle', settle)\n      truncate = pop(opts, 'truncate', truncate)\n      spring.setOpts(ext(opts, {\n        balance: function () {\n          var ox = w && px % w, oy = h && py % h;\n          var far = dist(ox, 0, w) > mx || dist(oy, 0, h) > my;\n          if (far)\n            Orb.move(self.hook || self,\n                     abs(ox) < w / 2 && !truncate ? -ox : sgn(ox) * w - ox,\n                     abs(oy) < h / 2 && !truncate ? -oy : sgn(oy) * h - oy)\n          if (!far)\n            settle && settle.call(this, rnd(px / (w || 1)), rnd(py / (h || 1)))\n          balance && balance.call(this, ox, oy)\n        }\n      }))\n    }\n    this.setOpts(opts)\n  }),\n\n  tether: Orb.type(function Tether(elem, jack, opts) {\n    var bbox, xmin, xmax, ymin, ymax, rx, ry, px, py;\n    var opts = up({}, opts)\n    var self = this;\n    var plug = elem.orb({\n      move: function (dx, dy) {\n        self.px = px += dx;\n        self.py = py += dy;\n        return this.push(dx, dy, px, py, bbox)\n      }\n    }, jack)\n    var coil = elem.spring(plug, {kx: 1, ky: 1, lx: -1, ly: -1, lock: true})\n    this.elem = elem;\n    this.jack = cat(plug, coil)\n    this.move = function (dx, dy) {\n      var cx = 0, cy = 0, ix = dx, iy = dy;\n      var nx = px + dx + coil.dx, ny = py + dy + coil.dy;\n      var ux = nx - xmin, uy = ny - ymin;\n      var ox = nx - xmax, oy = ny - ymax;\n      if (ux < 0 && dx < 0) {\n        cx = (px < xmin ? dx : ux) / (rx * log(abs(coil.dx) + E))\n        ix = min(dx - ux, 0)\n      } else if (ox > 0 && dx > 0) {\n        cx = (px > xmax ? dx : ox) / (rx * log(abs(coil.dx) + E))\n        ix = max(dx - ox, 0)\n      }\n      if (uy < 0 && dy < 0) {\n        cy = (py < ymin ? dy : uy) / (ry * log(abs(coil.dy) + E))\n        iy = min(dy - uy, 0)\n      } else if (oy > 0 && dy > 0) {\n        cy = (py > ymax ? dy : oy) / (ry * log(abs(coil.dy) + E))\n        iy = max(dy - oy, 0)\n      }\n      Orb.move(coil, cx, cy)\n      return Orb.move(plug, cx + ix, cy + iy)\n    }\n\n    this.goto = function (x, y) {\n      return Orb.move(this, (x || 0) - (px + coil.dx), (y || 0) - (py + coil.dy))\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      bbox = new Sky.Box(opts.bbox || {}, true)\n      xmin = bbox.x; xmax = bbox.right;\n      ymin = bbox.y; ymax = bbox.bottom;\n      rx = opts.rx || 1;\n      ry = opts.ry || 1;\n      px = self.px = def(opts.px, px || 0)\n      py = self.py = def(opts.py, py || 0)\n      if (px < xmin || px > xmax || py < ymin || py > ymax)\n        self.goto(px < xmin ? xmin : (py > xmax ? xmax : px),\n                  py < ymin ? ymin : (py > ymax ? ymax : py))\n    }\n    this.setOpts(opts)\n  }),\n\n  crank: Orb.type(function Crank(elem, jack, opts) {\n    var cx, cy;\n    var opts = up({}, opts)\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy, px, py) {\n      var c = elem.screen(cx, cy)\n      var rx = px - c.x, ry = py - c.y;\n      if (rx > 0)\n        dy = -dy;\n      if (ry < 0)\n        dx = -dx;\n      return this.push(dx + dy, 0, this)\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      cx = opts.cx || 0;\n      cy = opts.cy || 0;\n    }\n    this.setOpts(opts)\n  }),\n\n  wagon: Orb.type(function Wagon(elem, jack, opts) {\n    var bbox, xmin, xmax, ymin, ymax, wide, high;\n    var opts = up({}, opts)\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy) {\n      var cur = elem.transformation(), off = cur.translate = cur.translate || [0, 0]\n      if (wide)\n        cur.translate[0] = clip(off[0] + dx, xmin, xmax)\n      if (high)\n        cur.translate[1] = clip(off[1] + dy, ymin, ymax)\n      elem.transform(this.push(dx, dy, cur) || cur)\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      bbox = new Sky.Box(opts.bbox || {}, true)\n      xmin = bbox.x; xmax = bbox.right;\n      ymin = bbox.y; ymax = bbox.bottom;\n      wide = bbox.width; high = bbox.height;\n    }\n    this.setOpts(opts)\n  }),\n\n  loop: Orb.type(function Loop(elem, jack, opts) {\n    var bbox, xmin, xmax, ymin, ymax, wide, high, wrap;\n    var opts = up({}, opts)\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy, cur) {\n      var off = cur.translate || [0, 0]\n      var ox = fnt(off[0], xmin), oy = fnt(off[1], ymin), lx = ox, ly = oy, over = true;\n      while (over) {\n        over = false;\n        if (wide) {\n          var wx = lx < xmin && 1 || lx > xmax && -1;\n          if (wx) {\n            over = true;\n            lx += wx * wide;\n            if (!wrap.call(this, wx, 0, ox, oy))\n              ox += wx * wide;\n          }\n        }\n        if (high) {\n          var wy = ly < ymin && 1 || ly > ymax && -1;\n          if (wy) {\n            over = true;\n            ly += wy * high;\n            if (!wrap.call(this, 0, wy, ox, oy))\n              oy += wy * high;\n          }\n        }\n      }\n      cur.translate = [ox, oy]\n      return this.push(dx, dy, cur) || cur;\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      bbox = new Sky.Box(opts.bbox || {}, true)\n      xmin = bbox.x; xmax = bbox.right;\n      ymin = bbox.y; ymax = bbox.bottom;\n      wide = bbox.width; high = bbox.height;\n      wrap = opts.wrap || noop;\n    }\n    this.setOpts(opts)\n  }),\n\n  belt: Orb.type(function Belt(elem, jack, opts) {\n    var wbox, bbox, draw;\n    var opts = up({h: true, v: true}, opts)\n    var self = this;\n    var orbs = [].concat(jack), n = orbs.length;\n    this.elem = elem;\n    this.jack = orbs.map(function (o, k) {\n      var e = o.elem; o.k = k;\n      return e.wagon(e.loop(o, {\n        wrap: function (wx, wy) {\n          var k_ = o.k;\n          if (draw.call(self, o, mapk(o.k += n * (wx + wy)), wx, wy))\n            return o.k = k_, true;\n        }\n      }))\n    }, [])\n\n    this.sync = function () {\n      orbs.map(function (o) { draw.call(self, o, mapk(o.k)) })\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      wbox = up(opts.h ? {} : {width: 0}, opts.v ? {} : {height: 0})\n      bbox = opts.bbox || elem.bbox()\n      draw = opts.draw || noop;\n      mapk = opts.mapk || id;\n      self.jack.map(function (w) {\n        w.setOpts({bbox: wbox})\n        w.jack.setOpts({bbox: bbox})\n      })\n    }\n    this.setOpts(opts)\n  }),\n\n  treadmill: Orb.type(function Treadmill(elem, jack, opts) {\n    var init, dims, soln, bbox, unit, shape, rows, cols;\n    var opts = up({h: true, v: true}, opts)\n    var orbs = []\n    var self = this;\n    this.elem = elem;\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      init = opts.init || id;\n\n      if (soln = Sky.Box.solve(up({bbox: opts.dims}, opts)) || soln) {\n        dims = bbox = soln.bbox; unit = soln.unit; shape = soln.shape;\n        shape = {rows: rows = shape.rows, cols: cols = shape.cols}\n      } else {\n        dims = bbox = unit = elem.bbox()\n        shape = {rows: rows = 1, cols: cols = 1}\n      }\n\n      if (opts.h) {\n        shape.cols = Math.ceil(cols + 1)\n        bbox = Sky.Box.solve({unit: unit, shape: shape}).bbox.shift(1 - unit.w, 0)\n      }\n      if (opts.v) {\n        shape.rows = Math.ceil(rows + 1)\n        bbox = Sky.Box.solve({unit: unit, shape: shape}).bbox.shift(0, 1 - unit.h)\n      }\n\n      orbs.map(function (o) { o.elem.remove() })\n      orbs = unit.stack(function (a, b) {\n        var o = elem.g().shift(b.x, b.y).orb({dims: b.xy()})\n        return a.push(init.call(self, o) || o), a;\n      }, [], shape)\n\n      self.dims = dims;\n      self.bbox = bbox;\n      self.unit = unit;\n      self.rows = rows;\n      self.cols = cols;\n      self.jack = elem.belt(cat(orbs, jack), ext(opts, {bbox: bbox}))\n      self.sync()\n    }\n    this.setOpts(opts)\n  }),\n\n  wheel: Orb.type(function Wheel(elem, jack, opts) {\n    var kx, ky, rx, ry, gunit, settle, active, window, offset, range, zero, u, i;\n    var opts = up({kx: 2, ky: 2, rx: 3, ry: 3}, opts)\n    var self = this;\n    var tmill = this.tmill = elem.treadmill(null)\n    var guide = this.guide = elem.guide(tmill)\n    var tether = guide.hook = elem.tether(cat(guide, jack))\n    this.thru(tmill, ['dims', 'bbox', 'unit', 'rows', 'cols'])\n    this.elem = elem;\n    this.jack = tether;\n    this.getActive = function () {\n      return guide.slot().map(function (v) { return -v })\n    }\n    this.setActive = function (x, y) {\n      return tether.goto(-x * u.w, -y * u.h)\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      kx = pop(opts, 'kx', kx)\n      ky = pop(opts, 'ky', ky)\n      rx = pop(opts, 'rx', rx)\n      ry = pop(opts, 'ry', ry)\n      gunit = pop(opts, 'gunit', gunit)\n      settle = pop(opts, 'settle', settle)\n      active = pop(opts, 'active', active)\n      window = pop(opts, 'window', window)\n      offset = pop(opts, 'offset', offset || [0, 0])\n      range = pop(opts, 'range', range)\n      zero = pop(opts, 'zero', zero || [0, 0])\n\n      tmill.setOpts(ext(opts, {mapk: function (k) { return k - i }}))\n      guide.setOpts({\n        kx: kx,\n        ky: ky,\n        unit: gunit || self.unit,\n        settle: function (x, y) { settle && settle(-x, -y) }\n      })\n\n      u = self.unit;\n      i = zero[0] + zero[1] * self.cols;\n\n      if (range) {\n        var r = up({rows: 1, cols: 1}, range)\n        var w = up({rows: self.rows, cols: self.cols}, window)\n        var a = Sky.box(0, 0, offset[0] * u.w, offset[1] * u.h)\n        var b = u.times({cols: max(r.cols - w.cols, 0), rows: max(r.rows - w.rows, 0)}).align(a, 1, 1)\n        tether.setOpts({bbox: Sky.box().join(b), rx: rx, ry: ry, px: 0, py: 0})\n      }\n\n      self.setActive.apply(this, active || [])\n      self.sync()\n    }\n    this.setOpts(opts)\n  })\n})\n\nSky.SVGElem.prototype.update({\n  dolly: Orb.type(function Dolly(elem, jack, opts) {\n    var vbox, bbox, xmin, xmax, ymin, ymax;\n    var opts = up({}, opts)\n    this.elem = elem;\n    this.jack = jack;\n    this.move = function (dx, dy) {\n      var cur = elem.node.viewBox.baseVal;\n      var dim = [clip(cur.x - dx, xmin, xmax),\n                 clip(cur.y - dy, ymin, ymax),\n                 cur.width, cur.height]\n      elem.attrs({viewBox: this.push(dx, dy, dim) || dim})\n    }\n\n    this.setOpts = function (o) {\n      opts = up(opts, o)\n      vbox = new Sky.Box(opts.vbox || elem.bbox())\n      bbox = new Sky.Box(opts.bbox || {}, true)\n      bbox = bbox.trim(0, vbox.width, 0, vbox.height)\n      xmin = bbox.x; xmax = bbox.right;\n      ymin = bbox.y; ymax = bbox.bottom;\n      elem.attrs({viewBox: vbox})\n    }\n    this.setOpts(opts)\n  })\n})\n","var Sky = require('..')\nvar Sun = require('../sun')\nvar Orb = require('../ext/orb')\nvar U = Sky.util, up = Sun.up, Cage = Sun.Cage;\n\nvar Nav = Sun.cls(function Nav(init, frame, opts) {\n  Cage.call(this)\n  this.pages = init(this)\n  this.frame = frame;\n  this.setOpts(opts)\n}, new Cage, {\n  setOpts: function (o) {\n    var self = this;\n    var opts = this.opts = up(this.opts || {manageHistory: false}, o)\n    if (opts.manageHistory) {\n      window.setTimeout(function () {\n        window.onpopstate = function (e) {\n          if (e.state)\n            self.go(self.fromHistory(e.state), null, true)\n        }\n      }, 1)\n    }\n  },\n\n  path: function (state) {\n    return {\n      tag: state.tag,\n      prev: state.prev ? this.path(state.prev) : undefined,\n      parent: state.parent ? this.path(state.parent) : undefined\n    }\n  },\n\n  toHash: function (keep, prior) {\n    var prior = prior || Sun.form.decode(window.location.hash.substr(1))\n    return '#' + Sun.form.encode(up(prior, {page: btoa(JSON.stringify(keep))}))\n  },\n\n  fromHash: function (hash) {\n    var obj = Sun.form.decode((hash || window.location.hash).substr(1))\n    return JSON.parse(atob(obj.page || '') || 'null')\n  },\n\n  toHistory: function (state) {\n    var page = this.pages[state.tag]\n    return page.toHistory ? page.toHistory(state) : this.path(state)\n  },\n\n  fromHistory: function (state) {\n    var page = this.pages[state.tag]\n    return page.fromHistory ? page.fromHistory(state) : state;\n  },\n\n  changeHistory: function (state, replace) {\n    var page = this.pages[state.tag]\n    var keep = this.toHistory(state)\n    window.history[replace ? 'replaceState' : 'pushState'](keep, page.title, this.toHash(keep))\n  },\n\n  launch: function (state, opts) {\n    var kept = this.opts.manageHistory && this.fromHash()\n    if (kept)\n      return this.go(this.fromHistory(kept), opts, true)\n    return this.go(state, opts)\n  },\n\n  do: function () {\n    return this.action.apply(this, arguments)()\n  },\n  go: function (state, opts, load) {\n    return this.do(load ? 'load' : 'push', state, opts)\n  },\n\n  action: function () {\n    return this.segue(this.bind.apply(this, arguments))\n  },\n\n  segue: function (fn) {\n    var self = this;\n    return function () {\n      return Orb.drag(fn.apply(self, arguments), 'move', [100])\n    }\n  },\n\n  bind: function (key) {\n    var fn = this[key]\n    return fn.bind.apply(fn, [this].concat([].slice.call(arguments, 1)))\n  },\n\n  draw: function (tag, win) {\n    return this.pages[tag].draw(win) || win;\n  },\n\n  redraw: function (win) {\n    return this.draw(win.state.tag, win.reset() || win)\n  },\n\n  // -> to STATE\n\n  load: function (state, opts) {\n    var state = up(state, {nav: this})\n    return this.draw(state.tag, this.frame.window(state, opts))\n  },\n\n  reload: function (state, data) {\n    var state = data ? up(state, {data: data}) : state;\n    return this.load(state, {transition: 'same'})\n  },\n\n  push: function (state, opts) {\n    if (this.opts.manageHistory)\n      this.changeHistory(state)\n    return this.load(state, opts)\n  },\n\n  // from STATE ->\n\n  step: function (state, tag, data) {\n    var state = {tag: tag, data: data, prev: state, parent: state.parent}\n    return this.push(state, {transition: 'next'})\n  },\n  back: function (state, data) {\n    var state = up(state.prev, {data: U.dfn(data, state.data)})\n    return this.push(state, {transition: 'prev'})\n  },\n\n  open: function (state, tag, data) {\n    var state = {tag: tag, data: data, parent: state}\n    return this.push(state, {transition: 'new'})\n  },\n  shut: function (state, data) {\n    var state = up(state.parent, {data: U.dfn(data, state.data)})\n    return this.push(state, {transition: 'old'})\n  }\n})\n\nvar Frame = Sun.cls(function Frame(pkg, elem, opts) {\n  Cage.call(this)\n  this.elem = elem;\n  this.window = pkg.window;\n  this.windows = []\n  this.on('top', function (n, o) {\n    if (o !== n) {\n      o && o.didBecomeInactive()\n      n && n.didBecomeActive()\n    }\n  })\n  this.setOpts(opts)\n}, new Cage, {\n  setOpts: function (o) {\n    this.opts = up(this.opts || {kx: 1.5}, o)\n    this.dims = this.opts.dims || this.elem.bbox()\n    this.line = this.opts.line || this.dims.copy({h: 20})\n    this.windows.map(function (win) {\n      win.state.nav.redraw(win)\n    })\n  },\n  addWindow: function (win) {\n    this.windows.push(win)\n  },\n  removeWindow: function (win) {\n    Sun.list.drop(this.windows, win)\n  }\n})\n\nvar Window = Sun.cls(function Window(frame, state, opts) {\n  var self = this;\n  var elem = this.elem = this.elem || frame.elem;\n  this.thru(frame, ['dims', 'line'])\n  this.frame = frame;\n  this.state = up(state, {win: this})\n  this.percent = 0;\n  this.jack = elem.spring(elem.orb({\n    move: function (dx) {\n      self.xfer.call(this, self.percent = U.clip(self.percent + dx, 0, 100))\n    }\n  }, this.plugs = []), {\n    balance: function () {\n      var percent = self.percent;\n      if (percent >= 50) {\n        if (percent < 100)\n          return this.move(100 - percent)\n        else\n          self.doBecomeActive()\n      } else {\n        if (percent > 0)\n          return this.move(-percent)\n        else\n          self.didNotBecomeActive()\n      }\n    }\n  })\n  this.setOpts(opts)\n  this.frame.addWindow(self)\n}, {\n  setOpts: function (o) {\n    this.opts = up(this.opts || {kx: this.frame.opts.kx}, o)\n    this.jack.setOpts({kx: this.opts.kx})\n  },\n  doBecomeActive: function () {\n    this.frame.change('top', this)\n  },\n  didBecomeActive: function () { },\n  didBecomeInactive: function () { this.remove() },\n  didNotBecomeActive: function () { this.remove() },\n  remove: function () {\n    if (this.elem !== this.frame.elem)\n      this.elem.remove()\n    this.frame.removeWindow(this)\n  },\n  reset: function () { return this },\n  xfer: function (p) { this.push(p) },\n\n  do: function (what) {\n    var state = this.state, nav = state.nav;\n    return nav.do.apply(nav, [what, state].concat([].slice.call(arguments, 1)))\n  },\n  action: function (what) {\n    var state = this.state, nav = state.nav;\n    return nav.action.apply(nav, [what, state].concat([].slice.call(arguments, 1)))\n  }\n})\n\nvar Basic = {\n  frame: Orb.type(Frame, Frame.prototype),\n  window: Orb.type(Window, Window.prototype)\n}\n\nvar UFO = module.exports = {\n  Nav: Nav,\n  Frame: Frame,\n  Window: Window,\n  Basic: Basic\n}\n","var Sky = require('../sky')\nvar Sun = require('../sun')\nvar Orb = require('../ext/orb')\nvar UFO = require('./ufo')\nvar P = Sky.path, up = Sun.up;\n\nSky.Elem.prototype.update({\n  button: function (fun, opts, jack) {\n    return this.g({class: 'button'}).tap(fun, opts, jack)\n  },\n  chevron: function (cx, cy, w, h, t) {\n    var box = Sky.box(0, 0, Math.abs(w), Math.abs(h || 2 * w))\n    return this.svgX(box.center(cx, cy)).chevron(cx, cy, w, h, t)\n  }\n})\n\nSky.SVGElem.prototype.update({\n  chevron: function (cx, cy, w, h, t) {\n    return this.path(P.chevron(cx, cy, w, h, t)).addClass('chevron')\n  }\n})\n\nvar iOS7x = {\n  frame: Orb.type(function iOS7xFrame(pkg, elem, opts) {\n    var elem = this.elem = elem.g({class: 'frame'})\n    UFO.Frame.call(this, pkg, elem, opts)\n  }, UFO.Frame.prototype),\n\n  window: Orb.type(function iOS7xWindow(frame, state, opts) {\n    var opts = up({}, opts)\n    var self = this;\n    var elem = this.elem = frame.elem.g({class: 'window'})\n    var content = this.content = elem.g({class: 'content'})\n    var chrome = this.chrome = elem.g({class: 'chrome'})\n\n    switch (opts.transition) {\n    case 'next':\n      self.xfer = function (p) {\n        if (frame.top) {\n          frame.top.chrome.style({opacity: 1 - p / 100})\n          Orb.move(frame.top.plugs, -p / 100)\n        }\n        chrome.style({opacity: p / 100})\n        content.transform({translate: (1 - p / 100) * self.dims.w})\n        this.push(1 - p / 100)\n      }\n      break;\n\n    case 'prev':\n      elem.order(0)\n      self.xfer = function (p) {\n        if (frame.top) {\n          frame.top.chrome.style({opacity: 1 - p / 100})\n          frame.top.content.transform({translate: p / 100 * self.dims.w})\n          Orb.move(frame.top.plugs, p / 100)\n        }\n        chrome.style({opacity: p / 100})\n        this.push(p / 100 - 1)\n      }\n      break;\n\n    case 'new':\n      self.xfer = function (p) {\n        elem.transform({translate: [0, (1 - p / 100) * self.dims.h]})\n        this.push(0, 1 - p / 100)\n      }\n      break;\n\n    case 'old':\n      elem.order(0)\n      self.xfer = function (p) {\n        if (frame.top) {\n          frame.top.elem.transform({translate: [0, p / 100 * self.dims.h]})\n          Orb.move(frame.top.plugs, 0, p / 100)\n        }\n        this.push(0)\n      }\n      break;\n\n    case 'same':\n    default:\n      self.xfer = function (p) { this.push(0) }\n      break;\n    }\n\n    UFO.Window.call(this, frame, state, opts)\n  }, UFO.Window.prototype, {\n    reset: function () {\n      this.chrome.clear()\n      this.content.clear()\n      this.plugs.splice(0, -1)\n    },\n\n    background: Orb.type(function Background(win, opts) {\n      var opts = this.opts = up({}, opts)\n      var dims = this.dims = win.dims;\n      var elem = this.elem = win.content.g({class: 'background'})\n      var bgrd = this.bgrd = elem.rectX(dims)\n    }),\n\n    navbar: Orb.type(function NavBar(win, opts) {\n      var x, y, w, h, d = win.dims;\n      var opts = this.opts = up({}, opts)\n      var line = this.line = win.line, q = line.h / 4;\n      var dims = this.dims = Sky.box(x = d.x, y = d.y, w = d.w, h = 2 * line.h)\n      var elem = this.elem = win.chrome.g({class: 'navbar'})\n\n      var m = dims.midY, b = dims.part([.3, .4, .3], true)\n      var state = win.state, nav = state.nav, page = nav.pages[state.tag], prev = state.prev;\n      var title = opts.title || page.title, left = opts.left, right = opts.right;\n\n      var bgrd = this.bgrd = elem.rect(x, y, w, h)\n\n      if (left) {\n        var lbtn = this.lbtn = elem.button(function () { left.action() }).addClass('left')\n        lbtn.text(x + 3 * q, m, left.label).anchor(-1, 0)\n        lbtn.rectX(b[0]).order(0)\n      } else if (prev) {\n        var back = this.back = elem.button(function () { win.action('back')(state.data) }).addClass('back')\n        back.chevron(x + 3 * q, m, -2 * q)\n        back.text(x + 5 * q, m, nav.pages[prev.tag].title).anchor(-1, 0)\n        back.rectX(b[0]).order(0)\n      }\n      if (right) {\n        var rbtn = this.rbtn = elem.button(function () { right.action() }).addClass('right')\n        rbtn.text(dims.right - 3 * q, m, right.label).anchor(1, 0)\n        rbtn.rectX(b[2]).order(0)\n      }\n\n      var tbar = this.tbar = elem.g()\n      tbar.text(dims.midX, m, title).anchor(0, 0).addClass('title')\n\n      win.plugs.push({\n        move: function (px) {\n          tbar.transform({translate: px < 0 ? px * (w / 2 - 12) : px * (w / 2 - 6)})\n        }\n      })\n    })\n  })\n}\n\nvar iOS = module.exports = {\n  iOS7x: iOS7x\n}\n"]}